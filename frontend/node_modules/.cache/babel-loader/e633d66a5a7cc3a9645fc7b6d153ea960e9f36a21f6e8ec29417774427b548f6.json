{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"mapping-section\"\n};\nconst _hoisted_2 = {\n  class: \"mapping-section-header\"\n};\nconst _hoisted_3 = {\n  class: \"chart-type-tag\"\n};\nconst _hoisted_4 = [\"innerHTML\"];\nconst _hoisted_5 = {\n  class: \"chart-type-name\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[0] || (_cache[0] = _createElementVNode(\"h4\", null, \"Data Mapping\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"span\", {\n    class: \"chart-type-icon\",\n    innerHTML: $setup.chartIcon\n  }, null, 8 /* PROPS */, _hoisted_4), _createElementVNode(\"span\", _hoisted_5, _toDisplayString($props.chartType), 1 /* TEXT */)])]), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.mappingFields, field => {\n    return _openBlock(), _createBlock($setup[\"MappingItem\"], {\n      key: field.name,\n      field: field,\n      mapping: $props.fieldMappings[field.name],\n      \"is-drag-over\": $setup.isDragOver[field.name],\n      \"has-error\": $setup.dragError[field.name],\n      onDrop: $setup.handleDrop,\n      onDragEnter: $setup.handleDragEnter,\n      onDragLeave: $setup.handleDragLeave,\n      onDragOver: $setup.handleDragOver,\n      onRemoveMapping: $setup.removeMapping,\n      onRemoveSeries: $setup.removeSeries\n    }, null, 8 /* PROPS */, [\"field\", \"mapping\", \"is-drag-over\", \"has-error\"]);\n  }), 128 /* KEYED_FRAGMENT */))]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","innerHTML","$setup","chartIcon","_hoisted_4","_hoisted_5","_toDisplayString","$props","chartType","_Fragment","_renderList","mappingFields","field","_createBlock","key","name","mapping","fieldMappings","isDragOver","dragError","onDrop","handleDrop","onDragEnter","handleDragEnter","onDragLeave","handleDragLeave","onDragOver","handleDragOver","onRemoveMapping","removeMapping","onRemoveSeries","removeSeries"],"sources":["D:\\Learning Material\\Git\\Fuck-Charts\\frontend\\src\\components\\DataMappingSection.vue"],"sourcesContent":["<template>\n  <div class=\"mapping-section\">\n    <div class=\"mapping-section-header\">\n      <h4>Data Mapping</h4>\n      <div class=\"chart-type-tag\">\n        <span class=\"chart-type-icon\" v-html=\"chartIcon\"></span>\n        <span class=\"chart-type-name\">{{ chartType }}</span>\n      </div>\n    </div>\n\n    <MappingItem\n      v-for=\"field in mappingFields\"\n      :key=\"field.name\"\n      :field=\"field\"\n      :mapping=\"fieldMappings[field.name]\"\n      :is-drag-over=\"isDragOver[field.name]\"\n      :has-error=\"dragError[field.name]\"\n      @drop=\"handleDrop\"\n      @drag-enter=\"handleDragEnter\"\n      @drag-leave=\"handleDragLeave\"\n      @drag-over=\"handleDragOver\"\n      @remove-mapping=\"removeMapping\"\n      @remove-series=\"removeSeries\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { chartIcons } from '../assets/JS/chartIcons.js'\nimport MappingItem from './MappingItem.vue'\n\nconst props = defineProps({\n  chartType: {\n    type: String,\n    required: true\n  },\n  fieldMappings: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits([\n  'update:fieldMappings', \n  'mapping-error',\n  'column-mapped'\n])\n\n// 拖拽状态\nconst isDragOver = ref({\n  xAxis: false,\n  yAxis: false,\n  series: false\n})\n\nconst dragError = ref({\n  xAxis: false,\n  yAxis: false,\n  series: false\n})\n\n// 计算图表图标\nconst chartIcon = computed(() => {\n  return chartIcons[props.chartType] || chartIcons['Bar'] || ''\n})\n\n// 根据图表类型定义映射字段\nconst mappingFields = computed(() => {\n  const baseFields = [\n    {\n      name: 'xAxis',\n      label: 'X Axis',\n      type: 'category',\n      required: true,\n      allowMultiple: false,\n      allowedTypes: ['string', 'category', 'date']\n    },\n    {\n      name: 'yAxis',\n      label: 'Y Axis',\n      type: 'value',\n      required: true,\n      allowMultiple: false,\n      allowedTypes: ['number', 'integer']\n    },\n    {\n      name: 'series',\n      label: 'Data Series',\n      type: 'value',\n      required: false,\n      allowMultiple: true,\n      allowedTypes: ['number', 'integer']\n    }\n  ]\n\n  // 根据图表类型调整字段\n  if (props.chartType === 'Pie' || props.chartType === 'pie') {\n    // 饼图不需要Y轴\n    return baseFields.filter(field => field.name !== 'yAxis')\n  }\n\n  return baseFields\n})\n\n// 拖拽处理\nfunction handleDragEnter(fieldName) {\n  isDragOver.value[fieldName] = true\n  dragError.value[fieldName] = false\n}\n\nfunction handleDragLeave(fieldName) {\n  isDragOver.value[fieldName] = false\n}\n\nfunction handleDragOver(event, fieldName) {\n  event.preventDefault()\n  isDragOver.value[fieldName] = true\n}\n\nfunction handleDrop(event, fieldName) {\n  event.preventDefault()\n  isDragOver.value[fieldName] = false\n\n  try {\n    const dragData = JSON.parse(event.dataTransfer.getData('text/plain'))\n\n    if (dragData.type === 'column') {\n      const column = dragData.column\n      const field = mappingFields.value.find(f => f.name === fieldName)\n\n      // 验证数据类型是否适合目标区域\n      if (validateColumnForField(column, field)) {\n        mapColumnToField(column, field)\n        emit('column-mapped', { field: fieldName, column })\n      } else {\n        dragError.value[fieldName] = true\n        emit('mapping-error', `Column \"${column.name}\" data type is not suitable for ${field.label}`)\n        setTimeout(() => {\n          dragError.value[fieldName] = false\n        }, 3000)\n      }\n    }\n  } catch (error) {\n    console.error('Drop failed:', error)\n    emit('mapping-error', 'Drag and drop failed, please try again')\n  }\n}\n\nfunction validateColumnForField(column, field) {\n  const columnType = column.type\n  return field.allowedTypes.includes(columnType)\n}\n\nfunction mapColumnToField(column, field) {\n  const newMappings = { ...props.fieldMappings }\n\n  if (field.allowMultiple) {\n    // 如果字段允许多个值（如系列）\n    const currentSeries = newMappings[field.name] || []\n    newMappings[field.name] = [...currentSeries, {\n      field: column.name,\n      type: column.type\n    }]\n  } else {\n    // 单个字段映射\n    newMappings[field.name] = {\n      field: column.name,\n      type: column.type\n    }\n  }\n\n  emit('update:fieldMappings', newMappings)\n}\n\nfunction removeMapping(fieldName) {\n  const newMappings = { ...props.fieldMappings }\n  const field = mappingFields.value.find(f => f.name === fieldName)\n  \n  if (field.allowMultiple) {\n    newMappings[fieldName] = []\n  } else {\n    newMappings[fieldName] = { field: '', type: '' }\n  }\n  \n  emit('update:fieldMappings', newMappings)\n}\n\nfunction removeSeries(fieldName, index) {\n  const newMappings = { ...props.fieldMappings }\n  const currentSeries = newMappings[fieldName] || []\n  currentSeries.splice(index, 1)\n  newMappings[fieldName] = currentSeries\n  emit('update:fieldMappings', newMappings)\n}\n</script>\n\n<style scoped>\n.mapping-section {\n  margin-bottom: 30px;\n  animation: fadeInUp 0.5s ease;\n  animation-delay: 0.2s;\n  animation-fill-mode: both;\n}\n\n.mapping-section-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 20px;\n  animation: slideInLeft 0.5s ease;\n  animation-delay: 0.3s;\n  animation-fill-mode: both;\n}\n\n.mapping-section-header h4 {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--text-color, #333333);\n}\n\n.chart-type-tag {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 4px 10px;\n  background: var(--primary-color, #5470c6);\n  color: white;\n  border-radius: 12px;\n  font-size: 11px;\n  font-weight: 500;\n  box-shadow: 0 2px 8px var(--shadow-color, rgba(84, 112, 198, 0.3));\n  position: relative;\n  transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);\n  animation: slideInRight 0.4s ease;\n}\n\n.chart-type-tag::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, var(--primary-color), var(--accent-color));\n  border-radius: 12px;\n  opacity: 0;\n  filter: blur(8px);\n  transition: opacity 0.4s ease;\n  z-index: -1;\n}\n\n.chart-type-tag:hover::after {\n  opacity: 0.7;\n}\n\n.chart-type-tag:hover {\n  transform: translateY(-3px) scale(1.05);\n  text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);\n  box-shadow: 0 5px 20px var(--shadow-color, rgba(84, 112, 198, 0.5));\n}\n\n.chart-type-icon {\n  font-size: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1);\n}\n\n.chart-type-tag:hover .chart-type-icon {\n  transform: scale(1.1);\n  animation: bounce 0.6s ease;\n}\n\n.chart-type-name {\n  font-size: 11px;\n  font-weight: 500;\n  transition: all 0.3s ease;\n}\n\n@keyframes slideInLeft {\n  from {\n    opacity: 0;\n    transform: translateX(-20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes slideInRight {\n  from {\n    opacity: 0;\n    transform: translateX(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes fadeInUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes bounce {\n  0%, 20%, 50%, 80%, 100% {\n    transform: translateY(0);\n  }\n  40% {\n    transform: translateY(-10px);\n  }\n  60% {\n    transform: translateY(-5px);\n  }\n}\n\n/* 暗黑主题适配 */\n[data-theme=\"dark\"] .chart-type-tag,\n:root.dark .chart-type-tag {\n  background: var(--primary-color, #6b9eff);\n  box-shadow: 0 2px 8px rgba(107, 158, 255, 0.3);\n}\n\n[data-theme=\"dark\"] .chart-type-tag::after,\n:root.dark .chart-type-tag::after {\n  background: linear-gradient(135deg, var(--primary-color, #6b9eff), var(--accent-color, #a8d068));\n}\n\n[data-theme=\"dark\"] .chart-type-tag:hover,\n:root.dark .chart-type-tag:hover {\n  text-shadow: 0 0 10px rgba(107, 158, 255, 0.6);\n  box-shadow: 0 5px 20px rgba(107, 158, 255, 0.4);\n}\n\n[data-theme=\"dark\"] .mapping-section-header h4,\n:root.dark .mapping-section-header h4 {\n  color: var(--text-color, #e0e0e0);\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAiB;;EACrBA,KAAK,EAAC;AAAwB;;EAE5BA,KAAK,EAAC;AAAgB;mBAJjC;;EAMcA,KAAK,EAAC;AAAiB;;uBALnCC,mBAAA,CAuBM,OAvBNC,UAuBM,GAtBJC,mBAAA,CAMM,OANNC,UAMM,G,0BALJD,mBAAA,CAAqB,YAAjB,cAAY,sBAChBA,mBAAA,CAGM,OAHNE,UAGM,GAFJF,mBAAA,CAAwD;IAAlDH,KAAK,EAAC,iBAAiB;IAACM,SAAkB,EAAVC,MAAA,CAAAC;0BAL9CC,UAAA,GAMQN,mBAAA,CAAoD,QAApDO,UAAoD,EAAAC,gBAAA,CAAnBC,MAAA,CAAAC,SAAS,iB,wBAI9CZ,mBAAA,CAaEa,SAAA,QAvBNC,WAAA,CAWsBR,MAAA,CAAAS,aAAa,EAAtBC,KAAK;yBADdC,YAAA,CAaEX,MAAA;MAXCY,GAAG,EAAEF,KAAK,CAACG,IAAI;MACfH,KAAK,EAAEA,KAAK;MACZI,OAAO,EAAET,MAAA,CAAAU,aAAa,CAACL,KAAK,CAACG,IAAI;MACjC,cAAY,EAAEb,MAAA,CAAAgB,UAAU,CAACN,KAAK,CAACG,IAAI;MACnC,WAAS,EAAEb,MAAA,CAAAiB,SAAS,CAACP,KAAK,CAACG,IAAI;MAC/BK,MAAI,EAAElB,MAAA,CAAAmB,UAAU;MAChBC,WAAU,EAAEpB,MAAA,CAAAqB,eAAe;MAC3BC,WAAU,EAAEtB,MAAA,CAAAuB,eAAe;MAC3BC,UAAS,EAAExB,MAAA,CAAAyB,cAAc;MACzBC,eAAc,EAAE1B,MAAA,CAAA2B,aAAa;MAC7BC,cAAa,EAAE5B,MAAA,CAAA6B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}