{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\n/* eslint-disable */\n/**\n * 文件上传与管理相关的 API 服务\n */\n\nimport * as XLSX from 'xlsx';\nconst API_BASE_URL = '/api';\n\n/**\n * 前端文件缓存系统\n */\nclass FileCache {\n  constructor() {\n    this.cacheKey = 'fuck-charts-file-cache';\n    this.filesKey = 'fuck-charts-cached-files';\n    this.maxCacheSize = 100 * 1024 * 1024; // 100MB\n    this.isBackendConnected = false;\n    this.checkBackendConnection();\n  }\n\n  // 检查后端连接状态\n  async checkBackendConnection() {\n    try {\n      const response = await fetch(`${API_BASE_URL}/health`, {\n        method: 'GET',\n        timeout: 3000\n      });\n      this.isBackendConnected = response.ok;\n    } catch (error) {\n      this.isBackendConnected = false;\n    }\n    return this.isBackendConnected;\n  }\n\n  // 获取缓存的文件列表\n  getCachedFiles() {\n    const cached = localStorage.getItem(this.cacheKey);\n    return cached ? JSON.parse(cached) : [];\n  }\n\n  // 保存文件到缓存\n  async saveToCacheFromFile(file) {\n    try {\n      const fileData = {\n        id: `local_${Date.now()}_${Math.random()}`,\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        lastModified: file.lastModified,\n        uploadTime: new Date().toISOString(),\n        status: 'local'\n      };\n\n      // 检查缓存大小\n      const currentFiles = this.getCachedFiles();\n      const totalSize = currentFiles.reduce((sum, f) => sum + f.size, 0);\n      if (totalSize + file.size > this.maxCacheSize) {\n        throw new Error('Cache size limit exceeded');\n      }\n\n      // 读取文件内容\n      const fileContent = await this.readFileContent(file);\n      fileData.content = fileContent;\n\n      // 保存到缓存\n      currentFiles.push(fileData);\n      localStorage.setItem(this.cacheKey, JSON.stringify(currentFiles));\n\n      // 保存文件二进制数据到 IndexedDB\n      await this.saveFileToIndexedDB(fileData.id, file);\n      return fileData;\n    } catch (error) {\n      console.error('缓存文件失败:', error);\n      throw error;\n    }\n  }\n\n  // 读取文件内容预览\n  async readFileContent(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = e => {\n        try {\n          const content = e.target.result;\n          if (file.name.endsWith('.csv')) {\n            resolve(this.parseCSVPreview(content));\n          } else if (file.name.match(/\\.(xlsx|xls)$/)) {\n            resolve(this.parseExcelPreview(content, file.name));\n          } else {\n            resolve({\n              type: 'unknown',\n              preview: 'File cached'\n            });\n          }\n        } catch (error) {\n          reject(error);\n        }\n      };\n      reader.onerror = reject;\n\n      // 根据文件类型选择读取方式\n      if (file.name.match(/\\.(xlsx|xls)$/)) {\n        reader.readAsArrayBuffer(file);\n      } else {\n        reader.readAsText(file, 'UTF-8');\n      }\n    });\n  }\n\n  // 解析CSV预览数据\n  parseCSVPreview(content) {\n    const lines = content.split('\\n').filter(line => line.trim());\n    if (lines.length === 0) {\n      return {\n        type: 'csv',\n        headers: [],\n        preview: [],\n        totalRows: 0\n      };\n    }\n\n    // 简单的CSV解析（处理基本的逗号分隔）\n    const parseCSVLine = line => {\n      const result = [];\n      let current = '';\n      let inQuotes = false;\n      for (let i = 0; i < line.length; i++) {\n        const char = line[i];\n        if (char === '\"') {\n          inQuotes = !inQuotes;\n        } else if (char === ',' && !inQuotes) {\n          result.push(current.trim());\n          current = '';\n        } else {\n          current += char;\n        }\n      }\n      result.push(current.trim());\n      return result;\n    };\n    const headers = parseCSVLine(lines[0]);\n    // 返回最多200行数据用于预览\n    const preview = lines.slice(1, 201).map(line => {\n      const values = parseCSVLine(line);\n      const row = {};\n      headers.forEach((header, index) => {\n        row[header] = values[index] || '';\n      });\n      return row;\n    });\n    return {\n      type: 'csv',\n      headers,\n      preview,\n      totalRows: lines.length - 1\n    };\n  }\n\n  // 保存文件到 IndexedDB\n  async saveFileToIndexedDB(fileId, file) {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open('FuckChartsFileDB', 1);\n      request.onerror = () => reject(request.error);\n      request.onsuccess = () => {\n        const db = request.result;\n        const transaction = db.transaction(['files'], 'readwrite');\n        const store = transaction.objectStore('files');\n        const fileData = {\n          id: fileId,\n          file: file,\n          timestamp: Date.now()\n        };\n        const addRequest = store.add(fileData);\n        addRequest.onsuccess = () => resolve();\n        addRequest.onerror = () => reject(addRequest.error);\n      };\n      request.onupgradeneeded = event => {\n        const db = event.target.result;\n        if (!db.objectStoreNames.contains('files')) {\n          db.createObjectStore('files', {\n            keyPath: 'id'\n          });\n        }\n      };\n    });\n  }\n\n  // 从 IndexedDB 获取文件\n  async getFileFromIndexedDB(fileId) {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open('FuckChartsFileDB', 1);\n      request.onerror = () => reject(request.error);\n      request.onsuccess = () => {\n        const db = request.result;\n        const transaction = db.transaction(['files'], 'readonly');\n        const store = transaction.objectStore('files');\n        const getRequest = store.get(fileId);\n        getRequest.onsuccess = () => resolve(getRequest.result?.file);\n        getRequest.onerror = () => reject(getRequest.error);\n      };\n    });\n  }\n\n  // 从缓存中删除文件\n  async removeFromCache(fileId) {\n    const currentFiles = this.getCachedFiles();\n    const filteredFiles = currentFiles.filter(f => f.id !== fileId);\n    localStorage.setItem(this.cacheKey, JSON.stringify(filteredFiles));\n\n    // 同时从 IndexedDB 删除\n    return new Promise(resolve => {\n      const request = indexedDB.open('FuckChartsFileDB', 1);\n      request.onsuccess = () => {\n        const db = request.result;\n        const transaction = db.transaction(['files'], 'readwrite');\n        const store = transaction.objectStore('files');\n        store.delete(fileId);\n        resolve();\n      };\n    });\n  }\n\n  // 获取缓存大小\n  getCacheSize() {\n    const files = this.getCachedFiles();\n    return files.reduce((sum, f) => sum + f.size, 0);\n  }\n\n  // 清空缓存\n  async clearCache() {\n    localStorage.removeItem(this.cacheKey);\n    return new Promise(resolve => {\n      const request = indexedDB.open('FuckChartsFileDB', 1);\n      request.onsuccess = () => {\n        const db = request.result;\n        const transaction = db.transaction(['files'], 'readwrite');\n        const store = transaction.objectStore('files');\n        store.clear();\n        resolve();\n      };\n    });\n  }\n}\n\n// 创建缓存实例\nconst fileCache = new FileCache();\n\n/**\n * 上传文件 - 智能选择前端缓存或后端上传\n * @param {File} file - 要上传的文件对象\n * @returns {Promise} 上传结果\n */\nexport async function uploadFile(file) {\n  // 先检查后端连接状态\n  const isBackendConnected = await fileCache.checkBackendConnection();\n  if (!isBackendConnected) {\n    // 后端未连接，使用前端缓存\n    console.log('后端未连接，使用前端缓存');\n    return await fileCache.saveToCacheFromFile(file);\n  }\n\n  // 后端已连接，尝试上传到后端\n  const formData = new FormData();\n  formData.append('file', file);\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/upload`, {\n      method: 'POST',\n      body: formData\n    });\n    if (!response.ok) {\n      throw new Error('Upload failed');\n    }\n    const result = await response.json();\n    result.status = 'uploaded';\n    return result;\n  } catch (error) {\n    console.error('后端上传失败，使用前端缓存:', error);\n    // 后端上传失败，回退到前端缓存\n    return await fileCache.saveToCacheFromFile(file);\n  }\n}\n\n/**\n * 获取所有文件列表（包括缓存和后端）\n * @returns {Promise<Array>} 文件列表\n */\nexport async function getAllFiles() {\n  const cachedFiles = fileCache.getCachedFiles();\n\n  // 检查后端连接\n  const isBackendConnected = await fileCache.checkBackendConnection();\n  if (!isBackendConnected) {\n    return cachedFiles;\n  }\n  try {\n    const response = await fetch(`${API_BASE_URL}/files`);\n    if (response.ok) {\n      const backendFiles = await response.json();\n      // 合并缓存文件和后端文件\n      return [...cachedFiles, ...backendFiles.map(f => ({\n        ...f,\n        status: 'uploaded'\n      }))];\n    }\n  } catch (error) {\n    console.error('获取后端文件列表失败:', error);\n  }\n  return cachedFiles;\n}\n\n/**\n * 同步缓存文件到后端\n * @param {string} fileId - 要同步的文件ID\n * @returns {Promise} 同步结果\n */\nexport async function syncCachedFileToBackend(fileId) {\n  const cachedFiles = fileCache.getCachedFiles();\n  const cachedFile = cachedFiles.find(f => f.id === fileId);\n  if (!cachedFile) {\n    throw new Error('File not found in cache');\n  }\n\n  // 从 IndexedDB 获取原始文件\n  const originalFile = await fileCache.getFileFromIndexedDB(fileId);\n  if (!originalFile) {\n    throw new Error('Original file not found');\n  }\n  const formData = new FormData();\n  formData.append('file', originalFile);\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/upload`, {\n      method: 'POST',\n      body: formData\n    });\n    if (!response.ok) {\n      throw new Error('Sync failed');\n    }\n    const result = await response.json();\n\n    // 更新缓存中的文件状态\n    const updatedFiles = cachedFiles.map(f => f.id === fileId ? {\n      ...f,\n      status: 'uploaded',\n      backendId: result.fileId\n    } : f);\n    localStorage.setItem('fuck-charts-file-cache', JSON.stringify(updatedFiles));\n    return result;\n  } catch (error) {\n    console.error('同步文件到后端失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 批量同步所有缓存文件到后端\n * @returns {Promise} 同步结果\n */\nexport async function syncAllCachedFilesToBackend() {\n  const cachedFiles = fileCache.getCachedFiles().filter(f => f.status === 'local');\n  const results = [];\n  for (const file of cachedFiles) {\n    try {\n      const result = await syncCachedFileToBackend(file.id);\n      results.push({\n        success: true,\n        fileId: file.id,\n        result\n      });\n    } catch (error) {\n      results.push({\n        success: false,\n        fileId: file.id,\n        error: error.message\n      });\n    }\n  }\n  return results;\n}\n\n/**\n * 检查后端连接状态\n * @returns {Promise<boolean>} 连接状态\n */\nexport async function checkBackendConnection() {\n  return await fileCache.checkBackendConnection();\n}\n\n/**\n * 获取文件预览数据\n * @param {string} fileId - 文件ID\n * @returns {Promise} 文件预览数据\n */\nexport async function getFilePreview(fileId) {\n  // 先检查是否为缓存文件\n  const cachedFiles = fileCache.getCachedFiles();\n  const cachedFile = cachedFiles.find(f => f.id === fileId);\n  if (cachedFile && cachedFile.content) {\n    return cachedFile.content;\n  }\n\n  // 检查后端连接\n  const isBackendConnected = await fileCache.checkBackendConnection();\n  if (!isBackendConnected) {\n    throw new Error('Backend not connected and no cached preview available');\n  }\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}/preview`);\n    if (!response.ok) {\n      throw new Error('Failed to get preview');\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('获取文件预览失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 从服务器或缓存删除文件\n * @param {string} fileId - 要删除的文件ID\n */\nexport async function deleteFile(fileId) {\n  // 检查是否为缓存文件\n  const cachedFiles = fileCache.getCachedFiles();\n  const cachedFile = cachedFiles.find(f => f.id === fileId);\n  if (cachedFile) {\n    // 删除缓存文件\n    await fileCache.removeFromCache(fileId);\n    return {\n      success: true,\n      message: 'File removed from cache'\n    };\n  }\n\n  // 尝试从后端删除\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {\n      method: 'DELETE'\n    });\n    if (!response.ok) {\n      throw new Error('Delete failed');\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('删除文件失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 重命名文件\n * @param {string} fileId - 文件ID\n * @param {string} newName - 新文件名\n */\nexport async function renameFile(fileId, newName) {\n  // 检查是否为缓存文件\n  const cachedFiles = fileCache.getCachedFiles();\n  const cachedFileIndex = cachedFiles.findIndex(f => f.id === fileId);\n  if (cachedFileIndex >= 0) {\n    // 重命名缓存文件\n    cachedFiles[cachedFileIndex].name = newName;\n    localStorage.setItem('fuck-charts-file-cache', JSON.stringify(cachedFiles));\n    return {\n      success: true,\n      message: 'File renamed in cache'\n    };\n  }\n\n  // 尝试在后端重命名\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}/rename`, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        name: newName\n      })\n    });\n    if (!response.ok) {\n      throw new Error('Rename failed');\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('重命名文件失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 获取缓存统计信息\n * @returns {Object} 缓存统计\n */\nexport function getCacheStats() {\n  const files = fileCache.getCachedFiles();\n  const size = fileCache.getCacheSize();\n  return {\n    fileCount: files.length,\n    totalSize: size,\n    formattedSize: formatFileSize(size),\n    files: files.map(f => ({\n      id: f.id,\n      name: f.name,\n      size: f.size,\n      formattedSize: formatFileSize(f.size),\n      uploadTime: f.uploadTime,\n      status: f.status\n    }))\n  };\n}\n\n/**\n * 清空前端缓存\n * @returns {Promise} 清空结果\n */\nexport async function clearCache() {\n  await fileCache.clearCache();\n  return {\n    success: true,\n    message: 'Cache cleared'\n  };\n}\n\n/**\n * 格式化文件大小\n * @param {number} bytes - 字节数\n * @returns {string} 格式化后的大小\n */\nfunction formatFileSize(bytes) {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}","map":{"version":3,"names":["XLSX","API_BASE_URL","FileCache","constructor","cacheKey","filesKey","maxCacheSize","isBackendConnected","checkBackendConnection","response","fetch","method","timeout","ok","error","getCachedFiles","cached","localStorage","getItem","JSON","parse","saveToCacheFromFile","file","fileData","id","Date","now","Math","random","name","size","type","lastModified","uploadTime","toISOString","status","currentFiles","totalSize","reduce","sum","f","Error","fileContent","readFileContent","content","push","setItem","stringify","saveFileToIndexedDB","console","Promise","resolve","reject","reader","FileReader","onload","e","target","result","endsWith","parseCSVPreview","match","parseExcelPreview","preview","onerror","readAsArrayBuffer","readAsText","lines","split","filter","line","trim","length","headers","totalRows","parseCSVLine","current","inQuotes","i","char","slice","map","values","row","forEach","header","index","fileId","request","indexedDB","open","onsuccess","db","transaction","store","objectStore","timestamp","addRequest","add","onupgradeneeded","event","objectStoreNames","contains","createObjectStore","keyPath","getFileFromIndexedDB","getRequest","get","removeFromCache","filteredFiles","delete","getCacheSize","files","clearCache","removeItem","clear","fileCache","uploadFile","log","formData","FormData","append","body","json","getAllFiles","cachedFiles","backendFiles","syncCachedFileToBackend","cachedFile","find","originalFile","updatedFiles","backendId","syncAllCachedFilesToBackend","results","success","message","getFilePreview","deleteFile","renameFile","newName","cachedFileIndex","findIndex","getCacheStats","fileCount","formattedSize","formatFileSize","bytes","k","sizes","floor","parseFloat","pow","toFixed"],"sources":["D:/Learning Material/Git/Fuck-Charts/newArchitecture/frontend_vue_design/src/services/FileServices.js"],"sourcesContent":["/* eslint-disable */\n/**\n * 文件上传与管理相关的 API 服务\n */\n\nimport * as XLSX from 'xlsx'\n\nconst API_BASE_URL = '/api'\n\n/**\n * 前端文件缓存系统\n */\nclass FileCache {\n    constructor() {\n        this.cacheKey = 'fuck-charts-file-cache'\n        this.filesKey = 'fuck-charts-cached-files'\n        this.maxCacheSize = 100 * 1024 * 1024 // 100MB\n        this.isBackendConnected = false\n        this.checkBackendConnection()\n    }\n\n    // 检查后端连接状态\n    async checkBackendConnection() {\n        try {\n            const response = await fetch(`${API_BASE_URL}/health`, {\n                method: 'GET',\n                timeout: 3000\n            })\n            this.isBackendConnected = response.ok\n        } catch (error) {\n            this.isBackendConnected = false\n        }\n        return this.isBackendConnected\n    }\n\n    // 获取缓存的文件列表\n    getCachedFiles() {\n        const cached = localStorage.getItem(this.cacheKey)\n        return cached ? JSON.parse(cached) : []\n    }\n\n    // 保存文件到缓存\n    async saveToCacheFromFile(file) {\n        try {\n            const fileData = {\n                id: `local_${Date.now()}_${Math.random()}`,\n                name: file.name,\n                size: file.size,\n                type: file.type,\n                lastModified: file.lastModified,\n                uploadTime: new Date().toISOString(),\n                status: 'local'\n            }\n\n            // 检查缓存大小\n            const currentFiles = this.getCachedFiles()\n            const totalSize = currentFiles.reduce((sum, f) => sum + f.size, 0)\n            \n            if (totalSize + file.size > this.maxCacheSize) {\n                throw new Error('Cache size limit exceeded')\n            }\n\n            // 读取文件内容\n            const fileContent = await this.readFileContent(file)\n            fileData.content = fileContent\n            \n            // 保存到缓存\n            currentFiles.push(fileData)\n            localStorage.setItem(this.cacheKey, JSON.stringify(currentFiles))\n            \n            // 保存文件二进制数据到 IndexedDB\n            await this.saveFileToIndexedDB(fileData.id, file)\n            \n            return fileData\n        } catch (error) {\n            console.error('缓存文件失败:', error)\n            throw error\n        }\n    }\n\n    // 读取文件内容预览\n    async readFileContent(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader()\n            reader.onload = (e) => {\n                try {\n                    const content = e.target.result\n                    if (file.name.endsWith('.csv')) {\n                        resolve(this.parseCSVPreview(content))\n                    } else if (file.name.match(/\\.(xlsx|xls)$/)) {\n                        resolve(this.parseExcelPreview(content, file.name))\n                    } else {\n                        resolve({ type: 'unknown', preview: 'File cached' })\n                    }\n                } catch (error) {\n                    reject(error)\n                }\n            }\n            reader.onerror = reject\n            \n            // 根据文件类型选择读取方式\n            if (file.name.match(/\\.(xlsx|xls)$/)) {\n                reader.readAsArrayBuffer(file)\n            } else {\n                reader.readAsText(file, 'UTF-8')\n            }\n        })\n    }\n\n    // 解析CSV预览数据\n    parseCSVPreview(content) {\n        const lines = content.split('\\n').filter(line => line.trim())\n        if (lines.length === 0) {\n            return { type: 'csv', headers: [], preview: [], totalRows: 0 }\n        }\n        \n        // 简单的CSV解析（处理基本的逗号分隔）\n        const parseCSVLine = (line) => {\n            const result = []\n            let current = ''\n            let inQuotes = false\n            \n            for (let i = 0; i < line.length; i++) {\n                const char = line[i]\n                \n                if (char === '\"') {\n                    inQuotes = !inQuotes\n                } else if (char === ',' && !inQuotes) {\n                    result.push(current.trim())\n                    current = ''\n                } else {\n                    current += char\n                }\n            }\n            \n            result.push(current.trim())\n            return result\n        }\n        \n        const headers = parseCSVLine(lines[0])\n        // 返回最多200行数据用于预览\n        const preview = lines.slice(1, 201).map(line => {\n            const values = parseCSVLine(line)\n            const row = {}\n            headers.forEach((header, index) => {\n                row[header] = values[index] || ''\n            })\n            return row\n        })\n        \n        return { type: 'csv', headers, preview, totalRows: lines.length - 1 }\n    }\n\n    // 保存文件到 IndexedDB\n    async saveFileToIndexedDB(fileId, file) {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open('FuckChartsFileDB', 1)\n            \n            request.onerror = () => reject(request.error)\n            request.onsuccess = () => {\n                const db = request.result\n                const transaction = db.transaction(['files'], 'readwrite')\n                const store = transaction.objectStore('files')\n                \n                const fileData = {\n                    id: fileId,\n                    file: file,\n                    timestamp: Date.now()\n                }\n                \n                const addRequest = store.add(fileData)\n                addRequest.onsuccess = () => resolve()\n                addRequest.onerror = () => reject(addRequest.error)\n            }\n            \n            request.onupgradeneeded = (event) => {\n                const db = event.target.result\n                if (!db.objectStoreNames.contains('files')) {\n                    db.createObjectStore('files', { keyPath: 'id' })\n                }\n            }\n        })\n    }\n\n    // 从 IndexedDB 获取文件\n    async getFileFromIndexedDB(fileId) {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open('FuckChartsFileDB', 1)\n            \n            request.onerror = () => reject(request.error)\n            request.onsuccess = () => {\n                const db = request.result\n                const transaction = db.transaction(['files'], 'readonly')\n                const store = transaction.objectStore('files')\n                const getRequest = store.get(fileId)\n                \n                getRequest.onsuccess = () => resolve(getRequest.result?.file)\n                getRequest.onerror = () => reject(getRequest.error)\n            }\n        })\n    }\n\n    // 从缓存中删除文件\n    async removeFromCache(fileId) {\n        const currentFiles = this.getCachedFiles()\n        const filteredFiles = currentFiles.filter(f => f.id !== fileId)\n        localStorage.setItem(this.cacheKey, JSON.stringify(filteredFiles))\n        \n        // 同时从 IndexedDB 删除\n        return new Promise((resolve) => {\n            const request = indexedDB.open('FuckChartsFileDB', 1)\n            request.onsuccess = () => {\n                const db = request.result\n                const transaction = db.transaction(['files'], 'readwrite')\n                const store = transaction.objectStore('files')\n                store.delete(fileId)\n                resolve()\n            }\n        })\n    }\n\n    // 获取缓存大小\n    getCacheSize() {\n        const files = this.getCachedFiles()\n        return files.reduce((sum, f) => sum + f.size, 0)\n    }\n\n    // 清空缓存\n    async clearCache() {\n        localStorage.removeItem(this.cacheKey)\n        return new Promise((resolve) => {\n            const request = indexedDB.open('FuckChartsFileDB', 1)\n            request.onsuccess = () => {\n                const db = request.result\n                const transaction = db.transaction(['files'], 'readwrite')\n                const store = transaction.objectStore('files')\n                store.clear()\n                resolve()\n            }\n        })\n    }\n}\n\n// 创建缓存实例\nconst fileCache = new FileCache()\n\n/**\n * 上传文件 - 智能选择前端缓存或后端上传\n * @param {File} file - 要上传的文件对象\n * @returns {Promise} 上传结果\n */\nexport async function uploadFile(file) {\n    // 先检查后端连接状态\n    const isBackendConnected = await fileCache.checkBackendConnection()\n    \n    if (!isBackendConnected) {\n        // 后端未连接，使用前端缓存\n        console.log('后端未连接，使用前端缓存')\n        return await fileCache.saveToCacheFromFile(file)\n    }\n    \n    // 后端已连接，尝试上传到后端\n    const formData = new FormData()\n    formData.append('file', file)\n\n    try {\n        const response = await fetch(`${API_BASE_URL}/files/upload`, {\n            method: 'POST',\n            body: formData\n        })\n\n        if (!response.ok) {\n            throw new Error('Upload failed')\n        }\n\n        const result = await response.json()\n        result.status = 'uploaded'\n        return result\n    } catch (error) {\n        console.error('后端上传失败，使用前端缓存:', error)\n        // 后端上传失败，回退到前端缓存\n        return await fileCache.saveToCacheFromFile(file)\n    }\n}\n\n/**\n * 获取所有文件列表（包括缓存和后端）\n * @returns {Promise<Array>} 文件列表\n */\nexport async function getAllFiles() {\n    const cachedFiles = fileCache.getCachedFiles()\n    \n    // 检查后端连接\n    const isBackendConnected = await fileCache.checkBackendConnection()\n    \n    if (!isBackendConnected) {\n        return cachedFiles\n    }\n    \n    try {\n        const response = await fetch(`${API_BASE_URL}/files`)\n        if (response.ok) {\n            const backendFiles = await response.json()\n            // 合并缓存文件和后端文件\n            return [...cachedFiles, ...backendFiles.map(f => ({ ...f, status: 'uploaded' }))]\n        }\n    } catch (error) {\n        console.error('获取后端文件列表失败:', error)\n    }\n    \n    return cachedFiles\n}\n\n/**\n * 同步缓存文件到后端\n * @param {string} fileId - 要同步的文件ID\n * @returns {Promise} 同步结果\n */\nexport async function syncCachedFileToBackend(fileId) {\n    const cachedFiles = fileCache.getCachedFiles()\n    const cachedFile = cachedFiles.find(f => f.id === fileId)\n    \n    if (!cachedFile) {\n        throw new Error('File not found in cache')\n    }\n    \n    // 从 IndexedDB 获取原始文件\n    const originalFile = await fileCache.getFileFromIndexedDB(fileId)\n    if (!originalFile) {\n        throw new Error('Original file not found')\n    }\n    \n    const formData = new FormData()\n    formData.append('file', originalFile)\n    \n    try {\n        const response = await fetch(`${API_BASE_URL}/files/upload`, {\n            method: 'POST',\n            body: formData\n        })\n        \n        if (!response.ok) {\n            throw new Error('Sync failed')\n        }\n        \n        const result = await response.json()\n        \n        // 更新缓存中的文件状态\n        const updatedFiles = cachedFiles.map(f => \n            f.id === fileId ? { ...f, status: 'uploaded', backendId: result.fileId } : f\n        )\n        localStorage.setItem('fuck-charts-file-cache', JSON.stringify(updatedFiles))\n        \n        return result\n    } catch (error) {\n        console.error('同步文件到后端失败:', error)\n        throw error\n    }\n}\n\n/**\n * 批量同步所有缓存文件到后端\n * @returns {Promise} 同步结果\n */\nexport async function syncAllCachedFilesToBackend() {\n    const cachedFiles = fileCache.getCachedFiles().filter(f => f.status === 'local')\n    const results = []\n    \n    for (const file of cachedFiles) {\n        try {\n            const result = await syncCachedFileToBackend(file.id)\n            results.push({ success: true, fileId: file.id, result })\n        } catch (error) {\n            results.push({ success: false, fileId: file.id, error: error.message })\n        }\n    }\n    \n    return results\n}\n\n/**\n * 检查后端连接状态\n * @returns {Promise<boolean>} 连接状态\n */\nexport async function checkBackendConnection() {\n    return await fileCache.checkBackendConnection()\n}\n\n/**\n * 获取文件预览数据\n * @param {string} fileId - 文件ID\n * @returns {Promise} 文件预览数据\n */\nexport async function getFilePreview(fileId) {\n    // 先检查是否为缓存文件\n    const cachedFiles = fileCache.getCachedFiles()\n    const cachedFile = cachedFiles.find(f => f.id === fileId)\n    \n    if (cachedFile && cachedFile.content) {\n        return cachedFile.content\n    }\n    \n    // 检查后端连接\n    const isBackendConnected = await fileCache.checkBackendConnection()\n    if (!isBackendConnected) {\n        throw new Error('Backend not connected and no cached preview available')\n    }\n    \n    try {\n        const response = await fetch(`${API_BASE_URL}/files/${fileId}/preview`)\n        if (!response.ok) {\n            throw new Error('Failed to get preview')\n        }\n        return await response.json()\n    } catch (error) {\n        console.error('获取文件预览失败:', error)\n        throw error\n    }\n}\n\n/**\n * 从服务器或缓存删除文件\n * @param {string} fileId - 要删除的文件ID\n */\nexport async function deleteFile(fileId) {\n    // 检查是否为缓存文件\n    const cachedFiles = fileCache.getCachedFiles()\n    const cachedFile = cachedFiles.find(f => f.id === fileId)\n    \n    if (cachedFile) {\n        // 删除缓存文件\n        await fileCache.removeFromCache(fileId)\n        return { success: true, message: 'File removed from cache' }\n    }\n    \n    // 尝试从后端删除\n    try {\n        const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {\n            method: 'DELETE'\n        })\n        if (!response.ok) {\n            throw new Error('Delete failed')\n        }\n        return await response.json()\n    } catch (error) {\n        console.error('删除文件失败:', error)\n        throw error\n    }\n}\n\n/**\n * 重命名文件\n * @param {string} fileId - 文件ID\n * @param {string} newName - 新文件名\n */\nexport async function renameFile(fileId, newName) {\n    // 检查是否为缓存文件\n    const cachedFiles = fileCache.getCachedFiles()\n    const cachedFileIndex = cachedFiles.findIndex(f => f.id === fileId)\n    \n    if (cachedFileIndex >= 0) {\n        // 重命名缓存文件\n        cachedFiles[cachedFileIndex].name = newName\n        localStorage.setItem('fuck-charts-file-cache', JSON.stringify(cachedFiles))\n        return { success: true, message: 'File renamed in cache' }\n    }\n    \n    // 尝试在后端重命名\n    try {\n        const response = await fetch(`${API_BASE_URL}/files/${fileId}/rename`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({ name: newName })\n        })\n        if (!response.ok) {\n            throw new Error('Rename failed')\n        }\n        return await response.json()\n    } catch (error) {\n        console.error('重命名文件失败:', error)\n        throw error\n    }\n}\n\n/**\n * 获取缓存统计信息\n * @returns {Object} 缓存统计\n */\nexport function getCacheStats() {\n    const files = fileCache.getCachedFiles()\n    const size = fileCache.getCacheSize()\n    return {\n        fileCount: files.length,\n        totalSize: size,\n        formattedSize: formatFileSize(size),\n        files: files.map(f => ({\n            id: f.id,\n            name: f.name,\n            size: f.size,\n            formattedSize: formatFileSize(f.size),\n            uploadTime: f.uploadTime,\n            status: f.status\n        }))\n    }\n}\n\n/**\n * 清空前端缓存\n * @returns {Promise} 清空结果\n */\nexport async function clearCache() {\n    await fileCache.clearCache()\n    return { success: true, message: 'Cache cleared' }\n}\n\n/**\n * 格式化文件大小\n * @param {number} bytes - 字节数\n * @returns {string} 格式化后的大小\n */\nfunction formatFileSize(bytes) {\n    if (bytes === 0) return '0 Bytes'\n    const k = 1024\n    const sizes = ['Bytes', 'KB', 'MB', 'GB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}