{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\n// dataMergeUtils.js\n// 多文件数据合并与主键处理工具函数\n\n/**\n * 判断是否有主键（即所有y轴字段的文件都包含x轴字段）\n * @param {Object} xAxis - x轴配置\n * @param {Array|Object} yAxis - y轴配置\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {boolean}\n */\nexport function hasPrimaryKey(xAxis, yAxis, fileDataMap) {\n  if (!xAxis || !xAxis.field) return false;\n  const xField = xAxis.field;\n  const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n  return yArr.every(y => {\n    const yFileData = fileDataMap[y.file];\n    return yFileData && yFileData.length > 0 && yFileData[0].hasOwnProperty(xField);\n  });\n}\n\n/**\n * 合并多文件数据，返回 { xData, yDataArr, mergeType }\n * @param {Object} config - chartConfig\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {Object}\n */\nexport function mergeChartData(config, fileDataMap) {\n  const {\n    xAxis,\n    yAxis\n  } = config;\n  const mainData = fileDataMap[xAxis.file] || [];\n  const xData = mainData.map(row => row[xAxis.field]);\n  const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n  const usePrimaryKey = hasPrimaryKey(xAxis, yAxis, fileDataMap);\n  let yDataArr = [];\n  if (usePrimaryKey) {\n    // 主键合并（左连接）\n    yDataArr = yArr.map(y => {\n      const yFileData = fileDataMap[y.file] || [];\n      return mainData.map(row => {\n        const match = yFileData.find(r => r[xAxis.field] === row[xAxis.field]);\n        return match ? parseFloat(match[y.field]) || 0 : null;\n      });\n    });\n  } else {\n    // 行号对齐\n    yDataArr = yArr.map(y => {\n      const yFileData = fileDataMap[y.file] || [];\n      let arr = yFileData.map(row => parseFloat(row[y.field]) || 0);\n      if (arr.length > xData.length) arr = arr.slice(0, xData.length);\n      while (arr.length < xData.length) arr.push(null);\n      return arr;\n    });\n  }\n  return {\n    xData,\n    yDataArr,\n    mergeType: usePrimaryKey ? 'primaryKey' : 'rowIndex'\n  };\n}","map":{"version":3,"names":["hasPrimaryKey","xAxis","yAxis","fileDataMap","field","xField","yArr","Array","isArray","every","y","yFileData","file","length","hasOwnProperty","mergeChartData","config","mainData","xData","map","row","usePrimaryKey","yDataArr","match","find","r","parseFloat","arr","slice","push","mergeType"],"sources":["D:/Learning Material/Git/Fuck-Charts/frontend/src/assets/JS/utils/dataMergeUtils.js"],"sourcesContent":["// dataMergeUtils.js\n// 多文件数据合并与主键处理工具函数\n\n\n\n/**\n * 判断是否有主键（即所有y轴字段的文件都包含x轴字段）\n * @param {Object} xAxis - x轴配置\n * @param {Array|Object} yAxis - y轴配置\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {boolean}\n */\nexport function hasPrimaryKey(xAxis, yAxis, fileDataMap) {\n    if (!xAxis || !xAxis.field) return false;\n    const xField = xAxis.field;\n    const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n    return yArr.every(y => {\n        const yFileData = fileDataMap[y.file];\n        return yFileData && yFileData.length > 0 && yFileData[0].hasOwnProperty(xField);\n    });\n}\n\n/**\n * 合并多文件数据，返回 { xData, yDataArr, mergeType }\n * @param {Object} config - chartConfig\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {Object}\n */\nexport function mergeChartData(config, fileDataMap) {\n    const { xAxis, yAxis } = config;\n    const mainData = fileDataMap[xAxis.file] || [];\n    const xData = mainData.map(row => row[xAxis.field]);\n    const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n    const usePrimaryKey = hasPrimaryKey(xAxis, yAxis, fileDataMap);\n    let yDataArr = [];\n    if (usePrimaryKey) {\n        // 主键合并（左连接）\n        yDataArr = yArr.map(y => {\n        const yFileData = fileDataMap[y.file] || [];\n        return mainData.map(row => {\n            const match = yFileData.find(r => r[xAxis.field] === row[xAxis.field]);\n            return match ? parseFloat(match[y.field]) || 0 : null;\n        });\n        });\n    } else {\n        // 行号对齐\n        yDataArr = yArr.map(y => {\n        const yFileData = fileDataMap[y.file] || [];\n        let arr = yFileData.map(row => parseFloat(row[y.field]) || 0);\n        if (arr.length > xData.length) arr = arr.slice(0, xData.length);\n        while (arr.length < xData.length) arr.push(null);\n        return arr;\n        });\n    }\n    return { xData, yDataArr, mergeType: usePrimaryKey ? 'primaryKey' : 'rowIndex' };\n}\n"],"mappings":";;;;;AAAA;AACA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASA,aAAaA,CAACC,KAAK,EAAEC,KAAK,EAAEC,WAAW,EAAE;EACrD,IAAI,CAACF,KAAK,IAAI,CAACA,KAAK,CAACG,KAAK,EAAE,OAAO,KAAK;EACxC,MAAMC,MAAM,GAAGJ,KAAK,CAACG,KAAK;EAC1B,MAAME,IAAI,GAAGC,KAAK,CAACC,OAAO,CAACN,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC;EACnD,OAAOI,IAAI,CAACG,KAAK,CAACC,CAAC,IAAI;IACnB,MAAMC,SAAS,GAAGR,WAAW,CAACO,CAAC,CAACE,IAAI,CAAC;IACrC,OAAOD,SAAS,IAAIA,SAAS,CAACE,MAAM,GAAG,CAAC,IAAIF,SAAS,CAAC,CAAC,CAAC,CAACG,cAAc,CAACT,MAAM,CAAC;EACnF,CAAC,CAAC;AACN;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASU,cAAcA,CAACC,MAAM,EAAEb,WAAW,EAAE;EAChD,MAAM;IAAEF,KAAK;IAAEC;EAAM,CAAC,GAAGc,MAAM;EAC/B,MAAMC,QAAQ,GAAGd,WAAW,CAACF,KAAK,CAACW,IAAI,CAAC,IAAI,EAAE;EAC9C,MAAMM,KAAK,GAAGD,QAAQ,CAACE,GAAG,CAACC,GAAG,IAAIA,GAAG,CAACnB,KAAK,CAACG,KAAK,CAAC,CAAC;EACnD,MAAME,IAAI,GAAGC,KAAK,CAACC,OAAO,CAACN,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC;EACnD,MAAMmB,aAAa,GAAGrB,aAAa,CAACC,KAAK,EAAEC,KAAK,EAAEC,WAAW,CAAC;EAC9D,IAAImB,QAAQ,GAAG,EAAE;EACjB,IAAID,aAAa,EAAE;IACf;IACAC,QAAQ,GAAGhB,IAAI,CAACa,GAAG,CAACT,CAAC,IAAI;MACzB,MAAMC,SAAS,GAAGR,WAAW,CAACO,CAAC,CAACE,IAAI,CAAC,IAAI,EAAE;MAC3C,OAAOK,QAAQ,CAACE,GAAG,CAACC,GAAG,IAAI;QACvB,MAAMG,KAAK,GAAGZ,SAAS,CAACa,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACxB,KAAK,CAACG,KAAK,CAAC,KAAKgB,GAAG,CAACnB,KAAK,CAACG,KAAK,CAAC,CAAC;QACtE,OAAOmB,KAAK,GAAGG,UAAU,CAACH,KAAK,CAACb,CAAC,CAACN,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,IAAI;MACzD,CAAC,CAAC;IACF,CAAC,CAAC;EACN,CAAC,MAAM;IACH;IACAkB,QAAQ,GAAGhB,IAAI,CAACa,GAAG,CAACT,CAAC,IAAI;MACzB,MAAMC,SAAS,GAAGR,WAAW,CAACO,CAAC,CAACE,IAAI,CAAC,IAAI,EAAE;MAC3C,IAAIe,GAAG,GAAGhB,SAAS,CAACQ,GAAG,CAACC,GAAG,IAAIM,UAAU,CAACN,GAAG,CAACV,CAAC,CAACN,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC;MAC7D,IAAIuB,GAAG,CAACd,MAAM,GAAGK,KAAK,CAACL,MAAM,EAAEc,GAAG,GAAGA,GAAG,CAACC,KAAK,CAAC,CAAC,EAAEV,KAAK,CAACL,MAAM,CAAC;MAC/D,OAAOc,GAAG,CAACd,MAAM,GAAGK,KAAK,CAACL,MAAM,EAAEc,GAAG,CAACE,IAAI,CAAC,IAAI,CAAC;MAChD,OAAOF,GAAG;IACV,CAAC,CAAC;EACN;EACA,OAAO;IAAET,KAAK;IAAEI,QAAQ;IAAEQ,SAAS,EAAET,aAAa,GAAG,YAAY,GAAG;EAAW,CAAC;AACpF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}