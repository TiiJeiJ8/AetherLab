{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\n/* eslint-disable */\n/**\n * 文件上传与管理相关的 API 服务\n * 支持前端缓存和后端同步的双模式工作\n */\nimport * as XLSX from 'xlsx';\nconst API_BASE_URL = '/api';\nconst CACHE_KEY = 'fuck_charts_files';\n\n// 后端连接状态\nlet isBackendConnected = false;\n\n/**\n * 检测后端连接状态\n * @returns {Promise<boolean>} 连接状态\n */\nexport async function checkBackendConnection() {\n  try {\n    const response = await fetch(`${API_BASE_URL}/health`, {\n      method: 'GET',\n      timeout: 3000\n    });\n    isBackendConnected = response.ok;\n    return isBackendConnected;\n  } catch (error) {\n    isBackendConnected = false;\n    return false;\n  }\n}\n\n/**\n * 获取后端连接状态\n * @returns {boolean} 连接状态\n */\nexport function getBackendStatus() {\n  return isBackendConnected;\n}\n\n/**\n * 从本地缓存获取文件列表\n * @returns {Array} 缓存的文件列表\n */\nexport function getCachedFiles() {\n  try {\n    const cached = localStorage.getItem(CACHE_KEY);\n    return cached ? JSON.parse(cached) : [];\n  } catch (error) {\n    console.error('读取缓存失败:', error);\n    return [];\n  }\n}\n\n/**\n * 保存文件到本地缓存\n * @param {Object} fileInfo - 文件信息\n */\nexport function saveToCache(fileInfo) {\n  try {\n    const cached = getCachedFiles();\n    cached.push(fileInfo);\n    localStorage.setItem(CACHE_KEY, JSON.stringify(cached));\n  } catch (error) {\n    console.error('保存到缓存失败:', error);\n  }\n}\n\n/**\n * 从缓存中删除文件\n * @param {string} fileId - 文件ID\n */\nexport function removeFromCache(fileId) {\n  try {\n    const cached = getCachedFiles();\n    const filtered = cached.filter(file => file.id !== fileId);\n    localStorage.setItem(CACHE_KEY, JSON.stringify(filtered));\n  } catch (error) {\n    console.error('从缓存删除失败:', error);\n  }\n}\n\n/**\n * 解析Excel/CSV文件\n * @param {File} file - 文件对象\n * @returns {Promise<Object>} 解析结果\n */\nexport async function parseFileContent(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = e => {\n      try {\n        const data = e.target.result;\n        let workbook, worksheet, jsonData;\n        if (file.name.toLowerCase().endsWith('.csv')) {\n          // CSV文件解析\n          workbook = XLSX.read(data, {\n            type: 'string'\n          });\n          worksheet = workbook.Sheets[workbook.SheetNames[0]];\n          jsonData = XLSX.utils.sheet_to_json(worksheet, {\n            header: 1\n          });\n        } else {\n          // Excel文件解析\n          workbook = XLSX.read(data, {\n            type: 'array'\n          });\n          worksheet = workbook.Sheets[workbook.SheetNames[0]];\n          jsonData = XLSX.utils.sheet_to_json(worksheet, {\n            header: 1\n          });\n        }\n\n        // 限制预览行数\n        const previewData = jsonData.slice(0, 200);\n        resolve({\n          data: previewData,\n          totalRows: jsonData.length,\n          totalColumns: jsonData[0] ? jsonData[0].length : 0,\n          headers: jsonData[0] || []\n        });\n      } catch (error) {\n        reject(error);\n      }\n    };\n    reader.onerror = () => reject(new Error('文件读取失败'));\n    if (file.name.toLowerCase().endsWith('.csv')) {\n      reader.readAsText(file, 'utf-8');\n    } else {\n      reader.readAsArrayBuffer(file);\n    }\n  });\n}\n\n/**\n * 上传文件到服务器\n * @param {File} file - 要上传的文件对象\n * @returns {Promise} 上传结果\n */\nexport async function uploadFile(file) {\n  const formData = new FormData();\n  formData.append('file', file);\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/upload`, {\n      method: 'POST',\n      body: formData\n    });\n    if (!response.ok) {\n      throw new Error('Upload failed');\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('文件上传失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 获取文件预览数据\n * @param {string} fileId - 文件ID\n * @returns {Promise} 文件预览数据\n */\nexport async function getFilePreview(fileId) {\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}/preview`);\n    if (!response.ok) {\n      throw new Error('Failed to get preview');\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('获取文件预览失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 从服务器删除文件\n * @param {string} fileId - 要删除的文件ID\n */\nexport async function deleteFile(fileId) {\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {\n      method: 'DELETE'\n    });\n    if (!response.ok) {\n      throw new Error('Delete failed');\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('删除文件失败:', error);\n    throw error;\n  }\n}\n\n/**\n * 重命名文件\n * @param {string} fileId - 文件ID\n * @param {string} newName - 新文件名\n */\nexport async function renameFile(fileId, newName) {\n  try {\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}/rename`, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        name: newName\n      })\n    });\n    if (!response.ok) {\n      throw new Error('Rename failed');\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('重命名文件失败:', error);\n    throw error;\n  }\n}","map":{"version":3,"names":["XLSX","API_BASE_URL","CACHE_KEY","isBackendConnected","checkBackendConnection","response","fetch","method","timeout","ok","error","getBackendStatus","getCachedFiles","cached","localStorage","getItem","JSON","parse","console","saveToCache","fileInfo","push","setItem","stringify","removeFromCache","fileId","filtered","filter","file","id","parseFileContent","Promise","resolve","reject","reader","FileReader","onload","e","data","target","result","workbook","worksheet","jsonData","name","toLowerCase","endsWith","read","type","Sheets","SheetNames","utils","sheet_to_json","header","previewData","slice","totalRows","length","totalColumns","headers","onerror","Error","readAsText","readAsArrayBuffer","uploadFile","formData","FormData","append","body","json","getFilePreview","deleteFile","renameFile","newName"],"sources":["D:/Learning Material/Git/Fuck-Charts/newArchitecture/frontend_vue_design/src/services/FileServices.js"],"sourcesContent":["/* eslint-disable */\n/**\n * 文件上传与管理相关的 API 服务\n * 支持前端缓存和后端同步的双模式工作\n */\nimport * as XLSX from 'xlsx'\n\nconst API_BASE_URL = '/api'\nconst CACHE_KEY = 'fuck_charts_files'\n\n// 后端连接状态\nlet isBackendConnected = false\n\n/**\n * 检测后端连接状态\n * @returns {Promise<boolean>} 连接状态\n */\nexport async function checkBackendConnection() {\n    try {\n        const response = await fetch(`${API_BASE_URL}/health`, {\n            method: 'GET',\n            timeout: 3000\n        })\n        isBackendConnected = response.ok\n        return isBackendConnected\n    } catch (error) {\n        isBackendConnected = false\n        return false\n    }\n}\n\n/**\n * 获取后端连接状态\n * @returns {boolean} 连接状态\n */\nexport function getBackendStatus() {\n    return isBackendConnected\n}\n\n/**\n * 从本地缓存获取文件列表\n * @returns {Array} 缓存的文件列表\n */\nexport function getCachedFiles() {\n    try {\n        const cached = localStorage.getItem(CACHE_KEY)\n        return cached ? JSON.parse(cached) : []\n    } catch (error) {\n        console.error('读取缓存失败:', error)\n        return []\n    }\n}\n\n/**\n * 保存文件到本地缓存\n * @param {Object} fileInfo - 文件信息\n */\nexport function saveToCache(fileInfo) {\n    try {\n        const cached = getCachedFiles()\n        cached.push(fileInfo)\n        localStorage.setItem(CACHE_KEY, JSON.stringify(cached))\n    } catch (error) {\n        console.error('保存到缓存失败:', error)\n    }\n}\n\n/**\n * 从缓存中删除文件\n * @param {string} fileId - 文件ID\n */\nexport function removeFromCache(fileId) {\n    try {\n        const cached = getCachedFiles()\n        const filtered = cached.filter(file => file.id !== fileId)\n        localStorage.setItem(CACHE_KEY, JSON.stringify(filtered))\n    } catch (error) {\n        console.error('从缓存删除失败:', error)\n    }\n}\n\n/**\n * 解析Excel/CSV文件\n * @param {File} file - 文件对象\n * @returns {Promise<Object>} 解析结果\n */\nexport async function parseFileContent(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader()\n        \n        reader.onload = (e) => {\n            try {\n                const data = e.target.result\n                let workbook, worksheet, jsonData\n                \n                if (file.name.toLowerCase().endsWith('.csv')) {\n                    // CSV文件解析\n                    workbook = XLSX.read(data, { type: 'string' })\n                    worksheet = workbook.Sheets[workbook.SheetNames[0]]\n                    jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 })\n                } else {\n                    // Excel文件解析\n                    workbook = XLSX.read(data, { type: 'array' })\n                    worksheet = workbook.Sheets[workbook.SheetNames[0]]\n                    jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 })\n                }\n                \n                // 限制预览行数\n                const previewData = jsonData.slice(0, 200)\n                \n                resolve({\n                    data: previewData,\n                    totalRows: jsonData.length,\n                    totalColumns: jsonData[0] ? jsonData[0].length : 0,\n                    headers: jsonData[0] || []\n                })\n            } catch (error) {\n                reject(error)\n            }\n        }\n        \n        reader.onerror = () => reject(new Error('文件读取失败'))\n        \n        if (file.name.toLowerCase().endsWith('.csv')) {\n            reader.readAsText(file, 'utf-8')\n        } else {\n            reader.readAsArrayBuffer(file)\n        }\n    })\n}\n\n/**\n * 上传文件到服务器\n * @param {File} file - 要上传的文件对象\n * @returns {Promise} 上传结果\n */\nexport async function uploadFile(file) {\n    const formData = new FormData()\n    formData.append('file', file)\n\n    try {\n        const response = await fetch(`${API_BASE_URL}/files/upload`, {\n            method: 'POST',\n            body: formData\n        })\n\n        if (!response.ok) {\n            throw new Error('Upload failed')\n        }\n\n        return await response.json()\n    } catch (error) {\n        console.error('文件上传失败:', error)\n        throw error\n    }\n}\n\n/**\n * 获取文件预览数据\n * @param {string} fileId - 文件ID\n * @returns {Promise} 文件预览数据\n */\nexport async function getFilePreview(fileId) {\n    try {\n        const response = await fetch(`${API_BASE_URL}/files/${fileId}/preview`)\n        if (!response.ok) {\n            throw new Error('Failed to get preview')\n        }\n        return await response.json()\n    } catch (error) {\n        console.error('获取文件预览失败:', error)\n        throw error\n    }\n}\n\n/**\n * 从服务器删除文件\n * @param {string} fileId - 要删除的文件ID\n */\nexport async function deleteFile(fileId) {\n    try {\n        const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {\n            method: 'DELETE'\n        })\n        if (!response.ok) {\n            throw new Error('Delete failed')\n        }\n        return await response.json()\n    } catch (error) {\n        console.error('删除文件失败:', error)\n        throw error\n    }\n}\n\n/**\n * 重命名文件\n * @param {string} fileId - 文件ID\n * @param {string} newName - 新文件名\n */\nexport async function renameFile(fileId, newName) {\n    try {\n        const response = await fetch(`${API_BASE_URL}/files/${fileId}/rename`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({ name: newName })\n        })\n        if (!response.ok) {\n            throw new Error('Rename failed')\n        }\n        return await response.json()\n    } catch (error) {\n        console.error('重命名文件失败:', error)\n        throw error\n    }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}