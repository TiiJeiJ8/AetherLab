{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\n// utils/mappingValidator.js\n// 用于校验拖拽映射时的数据列维度和业务规则\n\n/* eslint-disable */\n\n/**\n * 校验拖拽的数据列是否符合目标映射区的要求\n * @param {Object} params\n * @param {Object} params.column - 拖拽的数据列对象 { name, type, file, length }\n * @param {String} params.target - 目标映射区 key，如 'xAxis', 'yAxis', 'series'\n * @param {Object} params.currentConfig - 当前的映射配置对象 chartConfig\n * @param {Object} params.fileDataMap - 全局文件数据映射（fileName => data array）\n * @param {String} params.chartType - 当前图表类型\n * @returns {Object} { valid: Boolean, message: String }\n */\n/**\n * 校验拖拽的数据列是否符合目标映射区的要求，并返回该列数据\n * @param {Object} params\n * @param {Object} params.column - 拖拽的数据列对象 { name, type, file }\n * @param {String} params.target - 目标映射区 key，如 'xAxis', 'yAxis', 'series'\n * @param {Object} params.currentConfig - 当前的映射配置对象 chartConfig\n * @param {Object} params.fileDataMap - 全局文件数据映射（fileName => data array）\n * @param {String} params.chartType - 当前图表类型\n * @returns {Object} { valid: Boolean, message: String, columnData: Array }\n */\nexport function validateMappingDimension({\n  column,\n  target,\n  currentConfig,\n  fileDataMap,\n  chartType\n}) {\n  // 获取当前X、Y轴已选字段的行数\n  function getFieldLength(fieldObj) {\n    if (!fieldObj || !fieldObj.field || !fieldObj.file) return 0;\n    const fileRows = fileDataMap[fieldObj.file] || [];\n    // 调试输出\n    console.log('[mappingValidator] getFieldLength:', {\n      file: fieldObj.file,\n      field: fieldObj.field,\n      fileDataMapKeys: Object.keys(fileDataMap),\n      fileRowsLength: fileRows.length\n    });\n    return fileRows.length;\n  }\n\n  // 获取某列的全部数据\n  function getColumnData(fieldObj) {\n    if (!fieldObj || !fieldObj.field || !fieldObj.file) return [];\n    const fileRows = fileDataMap[fieldObj.file] || [];\n    // 支持对象数组或对象\n    return fileRows.map(row => row[fieldObj.field]);\n  }\n\n  // 取当前映射的X、Y轴（支持多选）\n  const xAxis = currentConfig.xAxis;\n  const yAxis = currentConfig.yAxis;\n  let xLen = Array.isArray(xAxis) ? Math.max(...xAxis.map(getFieldLength), 0) : getFieldLength(xAxis);\n  let yLen = Array.isArray(yAxis) ? Math.max(...yAxis.map(getFieldLength), 0) : getFieldLength(yAxis);\n\n  // 拖入的列的行数和数据\n  const dragLen = fileDataMap[column.file]?.length || 0;\n  const columnData = fileDataMap[column.file]?.map(row => row[column.name]) || [];\n  // 拖拽调试输出\n  console.log('[mappingValidator] handleDrop:', {\n    column,\n    dragLen,\n    fileDataMapKeys: Object.keys(fileDataMap),\n    columnDataSample: columnData.slice(0, 5)\n  });\n\n  // 针对不同图表类型和目标区，制定规则\n  if (target === 'xAxis') {\n    // 只有y轴有数据时才校验\n    if (yLen > 0 && dragLen < yLen) {\n      return {\n        valid: false,\n        message: 'X轴数据行数不能小于Y轴',\n        columnData\n      };\n    }\n  }\n  if (target === 'yAxis') {\n    if (xLen > 0 && dragLen > xLen) {\n      return {\n        valid: false,\n        message: 'Y轴数据行数不能大于X轴',\n        columnData\n      };\n    }\n  }\n  // 其他图表类型可扩展\n  // if (chartType === 'pie') {...}\n\n  // 通过\n  return {\n    valid: true,\n    message: '',\n    columnData\n  };\n}","map":{"version":3,"names":["validateMappingDimension","column","target","currentConfig","fileDataMap","chartType","getFieldLength","fieldObj","field","file","fileRows","console","log","fileDataMapKeys","Object","keys","fileRowsLength","length","getColumnData","map","row","xAxis","yAxis","xLen","Array","isArray","Math","max","yLen","dragLen","columnData","name","columnDataSample","slice","valid","message"],"sources":["D:/Learning Material/Git/Fuck-Charts/frontend/src/utils/mappingValidator.js"],"sourcesContent":["// utils/mappingValidator.js\n// 用于校验拖拽映射时的数据列维度和业务规则\n\n/* eslint-disable */\n\n/**\n * 校验拖拽的数据列是否符合目标映射区的要求\n * @param {Object} params\n * @param {Object} params.column - 拖拽的数据列对象 { name, type, file, length }\n * @param {String} params.target - 目标映射区 key，如 'xAxis', 'yAxis', 'series'\n * @param {Object} params.currentConfig - 当前的映射配置对象 chartConfig\n * @param {Object} params.fileDataMap - 全局文件数据映射（fileName => data array）\n * @param {String} params.chartType - 当前图表类型\n * @returns {Object} { valid: Boolean, message: String }\n */\n/**\n * 校验拖拽的数据列是否符合目标映射区的要求，并返回该列数据\n * @param {Object} params\n * @param {Object} params.column - 拖拽的数据列对象 { name, type, file }\n * @param {String} params.target - 目标映射区 key，如 'xAxis', 'yAxis', 'series'\n * @param {Object} params.currentConfig - 当前的映射配置对象 chartConfig\n * @param {Object} params.fileDataMap - 全局文件数据映射（fileName => data array）\n * @param {String} params.chartType - 当前图表类型\n * @returns {Object} { valid: Boolean, message: String, columnData: Array }\n */\nexport function validateMappingDimension({ column, target, currentConfig, fileDataMap, chartType }) {\n    // 获取当前X、Y轴已选字段的行数\n    function getFieldLength(fieldObj) {\n        if (!fieldObj || !fieldObj.field || !fieldObj.file) return 0;\n        const fileRows = fileDataMap[fieldObj.file] || [];\n        // 调试输出\n        console.log('[mappingValidator] getFieldLength:', {\n            file: fieldObj.file,\n            field: fieldObj.field,\n            fileDataMapKeys: Object.keys(fileDataMap),\n            fileRowsLength: fileRows.length\n        });\n        return fileRows.length;\n    }\n\n    // 获取某列的全部数据\n    function getColumnData(fieldObj) {\n        if (!fieldObj || !fieldObj.field || !fieldObj.file) return [];\n        const fileRows = fileDataMap[fieldObj.file] || [];\n        // 支持对象数组或对象\n        return fileRows.map(row => row[fieldObj.field]);\n    }\n\n    // 取当前映射的X、Y轴（支持多选）\n    const xAxis = currentConfig.xAxis;\n    const yAxis = currentConfig.yAxis;\n    let xLen = Array.isArray(xAxis) ? Math.max(...xAxis.map(getFieldLength), 0) : getFieldLength(xAxis);\n    let yLen = Array.isArray(yAxis) ? Math.max(...yAxis.map(getFieldLength), 0) : getFieldLength(yAxis);\n\n    // 拖入的列的行数和数据\n    const dragLen = fileDataMap[column.file]?.length || 0;\n    const columnData = fileDataMap[column.file]?.map(row => row[column.name]) || [];\n    // 拖拽调试输出\n    console.log('[mappingValidator] handleDrop:', {\n        column,\n        dragLen,\n        fileDataMapKeys: Object.keys(fileDataMap),\n        columnDataSample: columnData.slice(0, 5)\n    });\n\n    // 针对不同图表类型和目标区，制定规则\n    if (target === 'xAxis') {\n        // 只有y轴有数据时才校验\n        if (yLen > 0 && dragLen < yLen) {\n            return { valid: false, message: 'X轴数据行数不能小于Y轴', columnData };\n        }\n    }\n    if (target === 'yAxis') {\n        if (xLen > 0 && dragLen > xLen) {\n            return { valid: false, message: 'Y轴数据行数不能大于X轴', columnData };\n        }\n    }\n    // 其他图表类型可扩展\n    // if (chartType === 'pie') {...}\n\n    // 通过\n    return { valid: true, message: '', columnData };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}