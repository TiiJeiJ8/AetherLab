{"ast":null,"code":"import { createElementVNode as _createElementVNode, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createVNode as _createVNode, toDisplayString as _toDisplayString, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, normalizeStyle as _normalizeStyle, Transition as _Transition, withCtx as _withCtx } from \"vue\";\nconst _hoisted_1 = {\n  class: \"history-content-rect\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"empty-history-tip\"\n};\nconst _hoisted_3 = {\n  class: \"history-list-rect\"\n};\nconst _hoisted_4 = {\n  class: \"thumb-title-row-rect\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  class: \"chart-history-title-rect\"\n};\nconst _hoisted_7 = [\"title\", \"onClick\"];\nconst _hoisted_8 = {\n  key: 0,\n  class: \"title-ellipsis-tooltip\"\n};\nconst _hoisted_9 = [\"onBlur\", \"onKeydown\", \"title\"];\nconst _hoisted_10 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", null, [_createVNode(_Transition, {\n    name: \"fade-slide\"\n  }, {\n    default: _withCtx(() => [$props.show ? (_openBlock(), _createElementBlock(\"div\", {\n      key: 0,\n      class: \"history-modal-draggable\",\n      style: _normalizeStyle($setup.modalStyle),\n      onMousedown: _withModifiers($setup.startDrag, [\"self\"])\n    }, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", {\n      class: \"history-header-rect\",\n      onMousedown: _withModifiers($setup.startDrag, [\"stop\"])\n    }, [_cache[1] || (_cache[1] = _createElementVNode(\"span\", {\n      style: {\n        \"margin\": \"15px\"\n      }\n    }, \"Charts Storage\", -1 /* HOISTED */)), _createElementVNode(\"button\", {\n      class: \"close-btn\",\n      style: {\n        \"margin\": \"15px\"\n      },\n      onClick: $setup.onClose\n    }, \"×\")], 32 /* NEED_HYDRATION */), !$props.chartHistory?.length ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \" No saved charts available. \")) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($props.chartHistory, (item, idx) => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        key: idx,\n        class: \"chart-history-item-rect\"\n      }, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", {\n        class: \"chart-thumb-rect\",\n        onClick: $event => $setup.onPreview(item)\n      }, [_createVNode($setup[\"ChartThumbnail\"], {\n        option: item.option\n      }, null, 8 /* PROPS */, [\"option\"])], 8 /* PROPS */, _hoisted_5), _createElementVNode(\"div\", _hoisted_6, [$setup.editingIndex !== idx ? (_openBlock(), _createElementBlock(_Fragment, {\n        key: 0\n      }, [_createElementVNode(\"span\", {\n        class: \"history-title-text\",\n        title: item.title,\n        onClick: $event => $setup.startEditTitle(idx, item.title),\n        style: {\n          \"cursor\": \"pointer\",\n          \"user-select\": \"text\"\n        }\n      }, _toDisplayString(item.title.length > 7 ? item.title.slice(0, 7) + '…' : item.title), 9 /* TEXT, PROPS */, _hoisted_7), item.title.length > 7 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, _toDisplayString(item.title), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */)) : _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n        key: 1,\n        ref_for: true,\n        ref: el => $setup.setEditInputRef(el, idx),\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.editTitle = $event),\n        class: \"history-title-input\",\n        onBlur: $event => $setup.saveEditTitle(idx),\n        onKeydown: [_withKeys(_withModifiers($event => $setup.saveEditTitle(idx), [\"prevent\"]), [\"enter\"]), _withKeys($setup.cancelEditTitle, [\"esc\"])],\n        maxlength: \"30\",\n        placeholder: 'Enter title',\n        style: {\n          \"width\": \"90%\",\n          \"max-width\": \"160px\",\n          \"font-size\": \"1em\",\n          \"border-radius\": \"5px\",\n          \"border\": \"1px solid #d0d0d0\",\n          \"padding\": \"2px 6px\"\n        },\n        title: $setup.editTitle,\n        autocomplete: \"off\"\n      }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_9)), [[_vModelText, $setup.editTitle]])]), _createElementVNode(\"button\", {\n        class: \"delete-btn-rect\",\n        onClick: _withModifiers($event => $setup.confirmDelete(idx), [\"stop\"]),\n        title: \"Delete\"\n      }, \"×\", 8 /* PROPS */, _hoisted_10)])]);\n    }), 128 /* KEYED_FRAGMENT */))])])], 36 /* STYLE, NEED_HYDRATION */)) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  }), _createVNode(_Transition, {\n    name: \"fade\"\n  }, {\n    default: _withCtx(() => [$setup.showDeleteConfirm ? (_openBlock(), _createElementBlock(\"div\", {\n      key: 0,\n      class: \"confirm-modal\",\n      onClick: _withModifiers($setup.cancelDelete, [\"self\"])\n    }, [_createElementVNode(\"div\", {\n      class: \"confirm-content\"\n    }, [_cache[2] || (_cache[2] = _createElementVNode(\"h3\", {\n      style: {\n        \"color\": \"var(--text-color)\"\n      }\n    }, \"Confirmation\", -1 /* HOISTED */)), _cache[3] || (_cache[3] = _createElementVNode(\"p\", null, \"Are you sure you want to delete this chart? This operation is irreversible.\", -1 /* HOISTED */)), _createElementVNode(\"div\", {\n      name: \"confirm-buttons\"\n    }, [_createElementVNode(\"button\", {\n      class: \"cancel-history-btn\",\n      onClick: $setup.cancelDelete\n    }, \"Cancel\"), _createElementVNode(\"button\", {\n      class: \"confirm-history-btn\",\n      onClick: $setup.handleDelete\n    }, \"Confirm\")])])])) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_createVNode","_Transition","name","default","_withCtx","$props","show","style","_normalizeStyle","$setup","modalStyle","onMousedown","_withModifiers","startDrag","_createElementVNode","_hoisted_1","onClick","onClose","chartHistory","length","_hoisted_2","_createCommentVNode","_hoisted_3","_Fragment","_renderList","item","idx","_hoisted_4","$event","onPreview","option","_hoisted_5","_hoisted_6","editingIndex","title","startEditTitle","slice","_hoisted_7","_hoisted_8","_toDisplayString","ref_for","ref","el","setEditInputRef","_cache","editTitle","onBlur","saveEditTitle","onKeydown","_withKeys","cancelEditTitle","maxlength","placeholder","autocomplete","_hoisted_9","confirmDelete","_hoisted_10","_","showDeleteConfirm","cancelDelete","handleDelete"],"sources":["D:\\Learning Material\\Git\\Fuck-Charts\\frontend\\src\\components\\Chart\\ChartHistoryModal.vue"],"sourcesContent":["<template>\n<div>\n<transition name=\"fade-slide\">\n    <div v-if=\"show\" class=\"history-modal-draggable\" :style=\"modalStyle\" @mousedown.self=\"startDrag\">\n        <div class=\"history-content-rect\">\n            <div class=\"history-header-rect\" @mousedown.stop=\"startDrag\">\n                <span style=\"margin: 15px;\">Charts Storage</span>\n                <button class=\"close-btn\" style=\"margin: 15px;\" @click=\"onClose\">×</button>\n            </div>\n            <div v-if=\"!chartHistory?.length\" class=\"empty-history-tip\">\n                No saved charts available.\n            </div>\n            <div class=\"history-list-rect\">\n            <div\n                v-for=\"(item, idx) in chartHistory\"\n                :key=\"idx\"\n                class=\"chart-history-item-rect\"\n            >\n                <div class=\"thumb-title-row-rect\">\n                <div class=\"chart-thumb-rect\" @click=\"onPreview(item)\">\n                    <ChartThumbnail :option=\"item.option\" />\n                </div>\n                <div class=\"chart-history-title-rect\">\n                    <template v-if=\"editingIndex !== idx\">\n                        <span\n                        class=\"history-title-text\"\n                        :title=\"item.title\"\n                        @click=\"startEditTitle(idx, item.title)\"\n                        style=\"cursor: pointer; user-select: text;\"\n                        >\n                        {{ item.title.length > 7 ? (item.title.slice(0, 7) + '…') : item.title }}\n                        </span>\n                        <span v-if=\"item.title.length > 7\" class=\"title-ellipsis-tooltip\">{{ item.title }}</span>\n                    </template>\n                    <template v-else>\n                        <input\n                        :ref=\"el => setEditInputRef(el, idx)\"\n                        v-model=\"editTitle\"\n                        class=\"history-title-input\"\n                        @blur=\"saveEditTitle(idx)\"\n                        @keydown.enter.prevent=\"saveEditTitle(idx)\"\n                        @keydown.esc=\"cancelEditTitle\"\n                        maxlength=\"30\"\n                        :placeholder=\"'Enter title'\"\n                        style=\"width: 90%; max-width: 160px; font-size: 1em; border-radius: 5px; border: 1px solid #d0d0d0; padding: 2px 6px;\"\n                        :title=\"editTitle\"\n                        autocomplete=\"off\"\n                        />\n                    </template>\n                </div>\n                <button class=\"delete-btn-rect\" @click.stop=\"confirmDelete(idx)\" title=\"Delete\">×</button>\n                </div>\n            </div>\n            </div>\n        </div>\n    </div>\n</transition>\n<transition name=\"fade\">\n    <div v-if=\"showDeleteConfirm\" class=\"confirm-modal\" @click.self=\"cancelDelete\">\n        <div class=\"confirm-content\">\n            <h3 style=\"color: var(--text-color);\">Confirmation</h3>\n            <p>Are you sure you want to delete this chart? This operation is irreversible.</p>\n            <div name=\"confirm-buttons\">\n            <button class=\"cancel-history-btn\" @click=\"cancelDelete\">Cancel</button>\n            <button class=\"confirm-history-btn\" @click=\"handleDelete\">Confirm</button>\n            </div>\n        </div>\n    </div>\n</transition>\n</div>\n</template>\n\n<script setup>\n/* eslint-disable */\nimport ChartThumbnail from './ChartThumbnail.vue'\nimport { ref, onMounted, onBeforeUnmount, defineEmits, defineProps, nextTick } from 'vue'\n// 拖拽浮窗相关\nconst modalStyle = ref({ left: '50vw', top: '12vh' })\nconst dragOffset = { x: 0, y: 0 }\nlet dragging = false\n\nfunction startDrag (e) {\n    if (e.button !== 0) return\n    dragging = true\n    const modal = document.querySelector('.history-modal-draggable')\n    const rect = modal.getBoundingClientRect()\n    dragOffset.x = e.clientX - rect.left\n    dragOffset.y = e.clientY - rect.top\n    document.addEventListener('mousemove', onDrag)\n    document.addEventListener('mouseup', stopDrag)\n}\nfunction onDrag (e) {\n    if (!dragging) return\n    let left = e.clientX - dragOffset.x\n    let top = e.clientY - dragOffset.y\n    // 限制在窗口内\n    const minLeft = 20\n    const minTop = 20\n    const maxLeft = window.innerWidth - 480 - 20\n    const maxTop = window.innerHeight - 420 - 20\n    left = Math.max(minLeft, Math.min(left, maxLeft))\n    top = Math.max(minTop, Math.min(top, maxTop))\n    modalStyle.value = { left: left + 'px', top: top + 'px' }\n}\nfunction stopDrag () {\n    dragging = false\n    document.removeEventListener('mousemove', onDrag)\n    document.removeEventListener('mouseup', stopDrag)\n}\nonMounted(() => {\n    // 初始居中\n    const w = 480\n    const h = 420\n    modalStyle.value = {\n        left: (window.innerWidth - w) / 2 + 'px',\n        top: (window.innerHeight - h) / 3 + 'px'\n    }\n})\nonBeforeUnmount(() => {\n    stopDrag()\n})\n// 删除确认\nconst showDeleteConfirm = ref(false)\nconst deleteIndex = ref(null)\n\nfunction confirmDelete (idx) {\n    deleteIndex.value = idx\n    showDeleteConfirm.value = true\n}\n\nfunction cancelDelete () {\n    showDeleteConfirm.value = false\n    deleteIndex.value = null\n}\n\nfunction handleDelete () {\n    if (deleteIndex.value !== null) {\n        emit('delete', deleteIndex.value)\n        showDeleteConfirm.value = false\n        deleteIndex.value = null\n    }\n}\n\n// props\nconst props = defineProps({\n    show: Boolean,\n    chartHistory: Array\n})\nconst emit = defineEmits(['close', 'preview', 'delete'])\nfunction onClose () { emit('close') }\nfunction onPreview(item) { emit('preview', item) }\n\n// 编辑标题相关\nconst editingIndex = ref(null)\nconst editTitle = ref('')\nconst editInputRefs = ref({})\n\nfunction setEditInputRef(el, idx) {\n    if (el) editInputRefs.value[idx] = el\n}\n\nfunction startEditTitle(idx, title) {\n    editingIndex.value = idx\n    editTitle.value = title\n    nextTick(() => {\n        const el = editInputRefs.value[idx]\n        if (el && typeof el.focus === 'function') el.focus()\n    })\n}\nfunction saveEditTitle(idx) {\n    const val = editTitle.value.trim()\n    if (!val) {\n        // 非空校验，可加提示\n        editTitle.value = ''\n        editingIndex.value = null\n        return\n    }\n    // 通知父组件更新标题，保持响应式\n    emit('update:title', { idx, title: val })\n    editingIndex.value = null\n}\nfunction cancelEditTitle() {\n    editingIndex.value = null\n}\n</script>\n\n<style scoped>\n\n@import '../../assets/CSS/ChartHistoryModal.css';\n\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}