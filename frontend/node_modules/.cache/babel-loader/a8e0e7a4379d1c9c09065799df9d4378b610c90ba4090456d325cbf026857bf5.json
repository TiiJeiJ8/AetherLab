{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { ref, nextTick } from 'vue';\nimport DataPreviewModal from './DataPreviewModal.vue';\nimport { uploadFile, deleteFile, renameFile, getFilePreview } from '../services/FileServices.js';\nexport default {\n  __name: 'FileUploadModal',\n  props: {\n    show: Boolean\n  },\n  emits: ['close'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n\n    /* eslint-disable */\n    const props = __props;\n    const emit = __emit;\n    const isDragging = ref(false);\n    const files = ref([]);\n    const showPreview = ref(false);\n    const previewFile = ref(null);\n    const previewData = ref([]);\n\n    // 触发文件选择\n    function triggerFileInput() {\n      document.querySelector('.file-input').click();\n    }\n\n    // // 处理文件选择\n    // async function handleFileSelect(event) {\n    //     const newFiles = Array.from(event.target.files)\n    //     await processFiles(newFiles)\n    // }\n\n    // // 处理拖拽\n    // async function handleDrop(event) {\n    //     isDragging.value = false\n    //     const newFiles = Array.from(event.dataTransfer.files)\n    //     await processFiles(newFiles)\n    // }\n\n    // 重命名相关\n    function startRename(idx) {\n      files.value[idx].isEditing = true;\n      files.value[idx].newName = files.value[idx].name;\n      nextTick(() => {\n        document.querySelector('.file-item input')?.focus();\n      });\n    }\n    function finishRename(idx) {\n      const file = files.value[idx];\n      if (file.newName && file.newName !== file.name) {\n        file.name = file.newName;\n        // 调用后端重命名API\n      }\n      file.isEditing = false;\n    }\n\n    // // 预览文件\n    // async function previewFile(idx) {\n    //     const file = files.value[idx]\n    //     previewFile.value = file\n    //     // 这里可以调用后端预览API获取数据\n    //     previewData.value = [\n    //         { id: 1, name: 'Test 1', value: 100 },\n    //         { id: 2, name: 'Test 2', value: 200 }\n    //     ]\n    //     showPreview.value = true\n    // }\n\n    function closePreview() {\n      showPreview.value = false;\n      previewFile.value = null;\n    }\n    function onClose() {\n      emit('close');\n    }\n\n    // 获取状态文本\n    function getStatusText(status) {\n      return {\n        local: 'Not uploaded',\n        uploading: 'Uploading',\n        uploaded: 'Uploaded',\n        error: 'Error'\n      }[status];\n    }\n\n    // 处理文件\n    async function processFiles(newFiles) {\n      const validFiles = newFiles.filter(file => {\n        const ext = file.name.split('.').pop().toLowerCase();\n        return ['csv', 'xlsx', 'xls'].includes(ext);\n      });\n      for (const file of validFiles) {\n        try {\n          files.value.push({\n            id: Date.now() + Math.random(),\n            name: file.name,\n            file: file,\n            status: 'uploading',\n            isEditing: false,\n            newName: file.name\n          });\n\n          // 调用上传 API\n          const response = await uploadFile(file);\n          // 更新文件状态\n          const uploadedFile = files.value.find(f => f.name === file.name);\n          if (uploadedFile) {\n            uploadedFile.status = 'uploaded';\n            uploadedFile.id = response.fileId; // 使用服务器返回的文件ID\n          }\n        } catch (error) {\n          console.error('Upload failed:', error);\n          const failedFile = files.value.find(f => f.name === file.name);\n          if (failedFile) {\n            failedFile.status = 'error';\n          }\n        }\n      }\n    }\n    const __returned__ = {\n      props,\n      emit,\n      isDragging,\n      files,\n      showPreview,\n      previewFile,\n      previewData,\n      triggerFileInput,\n      startRename,\n      finishRename,\n      closePreview,\n      onClose,\n      getStatusText,\n      processFiles,\n      ref,\n      nextTick,\n      DataPreviewModal,\n      get uploadFile() {\n        return uploadFile;\n      },\n      get deleteFile() {\n        return deleteFile;\n      },\n      get renameFile() {\n        return renameFile;\n      },\n      get getFilePreview() {\n        return getFilePreview;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","nextTick","DataPreviewModal","uploadFile","deleteFile","renameFile","getFilePreview","props","__props","emit","__emit","isDragging","files","showPreview","previewFile","previewData","triggerFileInput","document","querySelector","click","startRename","idx","value","isEditing","newName","name","focus","finishRename","file","closePreview","onClose","getStatusText","status","local","uploading","uploaded","error","processFiles","newFiles","validFiles","filter","ext","split","pop","toLowerCase","includes","push","id","Date","now","Math","random","response","uploadedFile","find","f","fileId","console","failedFile"],"sources":["D:/Learning Material/Git/Fuck-Charts/newArchitecture/frontend_vue_design/src/components/FileUploadModal.vue"],"sourcesContent":["<template>\n<transition name=\"fade-slide\">\n    <div v-if=\"show\" class=\"file-modal\" @click.self=\"onClose\">\n        <div class=\"file-content\">\n            <div class=\"file-header\">\n                <span>文件管理</span>\n                <button class=\"close-btn\" @click=\"onClose\">×</button>\n            </div>\n            \n            <!-- 拖拽上传区域 -->\n            <div class=\"upload-area\"\n                    :class=\"{ 'dragging': isDragging }\"\n                    @drop.prevent=\"handleDrop\"\n                    @dragover.prevent=\"isDragging = true\"\n                    @dragleave.prevent=\"isDragging = false\">\n                <input type=\"file\" \n                        ref=\"fileInput\"\n                        @change=\"handleFileSelect\"\n                        accept=\".csv,.xlsx,.xls\"\n                        multiple\n                        class=\"file-input\" />\n                <div class=\"upload-tip\">\n                    <i class=\"upload-icon\">📁</i>\n                    <p>拖拽文件到此处或 <button @click=\"triggerFileInput\">点击选择</button></p>\n                    <p class=\"sub-tip\">支持 CSV、XLSX、XLS 格式</p>\n                </div>\n            </div>\n\n            <!-- 文件列表 -->\n            <div class=\"file-list\" v-if=\"files.length\">\n                <div v-for=\"(file, idx) in files\" \n                        :key=\"file.id\" \n                        class=\"file-item\">\n                    <div class=\"file-info\">\n                        <span class=\"file-name\" \n                                :class=\"{ 'editing': file.isEditing }\"\n                                @dblclick=\"startRename(idx)\">\n                            <template v-if=\"!file.isEditing\">\n                                {{ file.name }}\n                            </template>\n                            <input v-else\n                                    v-model=\"file.newName\"\n                                    @blur=\"finishRename(idx)\"\n                                    @keyup.enter=\"finishRename(idx)\"\n                                    ref=\"renameInput\"\n                                    type=\"text\" />\n                        </span>\n                        <span class=\"file-status\" :class=\"file.status\">\n                            {{ getStatusText(file.status) }}\n                        </span>\n                    </div>\n                    <div class=\"file-actions\">\n                        <button @click=\"previewFile(idx)\"\n                                title=\"预览\">👁️</button>\n                        <button v-if=\"file.status === 'uploaded'\"\n                                @click=\"deleteFile(idx)\"\n                                title=\"从数据库删除\">🗑️</button>\n                        <button v-if=\"file.status === 'local'\"\n                                @click=\"unloadFile(idx)\"\n                                title=\"从缓存移除\">❌</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- 数据预览组件 -->\n        <DataPreviewModal\n            v-if=\"previewFile\"\n            :show=\"showPreview\"\n            :current-file=\"previewFile\"\n            :preview-data=\"previewData\"\n            :is-side-preview=\"true\"\n            @close=\"closePreview\"\n        />\n    </div>\n</transition>\n</template>\n\n<script setup>\n/* eslint-disable */\nimport { ref, nextTick } from 'vue'\nimport DataPreviewModal from './DataPreviewModal.vue'\nimport { uploadFile, deleteFile, renameFile, getFilePreview } from '../services/FileServices.js'\n\nconst props = defineProps({\n    show: Boolean\n})\n\nconst emit = defineEmits(['close'])\n\nconst isDragging = ref(false)\nconst files = ref([])\nconst showPreview = ref(false)\nconst previewFile = ref(null)\nconst previewData = ref([])\n\n// 触发文件选择\nfunction triggerFileInput() {\n    document.querySelector('.file-input').click()\n}\n\n// // 处理文件选择\n// async function handleFileSelect(event) {\n//     const newFiles = Array.from(event.target.files)\n//     await processFiles(newFiles)\n// }\n\n// // 处理拖拽\n// async function handleDrop(event) {\n//     isDragging.value = false\n//     const newFiles = Array.from(event.dataTransfer.files)\n//     await processFiles(newFiles)\n// }\n\n// 重命名相关\nfunction startRename(idx) {\n    files.value[idx].isEditing = true\n    files.value[idx].newName = files.value[idx].name\n    nextTick(() => {\n        document.querySelector('.file-item input')?.focus()\n    })\n}\n\nfunction finishRename(idx) {\n    const file = files.value[idx]\n    if (file.newName && file.newName !== file.name) {\n        file.name = file.newName\n        // 调用后端重命名API\n    }\n    file.isEditing = false\n}\n\n// // 预览文件\n// async function previewFile(idx) {\n//     const file = files.value[idx]\n//     previewFile.value = file\n//     // 这里可以调用后端预览API获取数据\n//     previewData.value = [\n//         { id: 1, name: 'Test 1', value: 100 },\n//         { id: 2, name: 'Test 2', value: 200 }\n//     ]\n//     showPreview.value = true\n// }\n\nfunction closePreview() {\n    showPreview.value = false\n    previewFile.value = null\n}\n\nfunction onClose() {\n    emit('close')\n}\n\n// 获取状态文本\nfunction getStatusText(status) {\n    return {\n        local: 'Not uploaded',\n        uploading: 'Uploading',\n        uploaded: 'Uploaded',\n        error: 'Error'\n    }[status]\n}\n\n// 处理文件\nasync function processFiles(newFiles) {\n    const validFiles = newFiles.filter(file => {\n        const ext = file.name.split('.').pop().toLowerCase()\n        return ['csv', 'xlsx', 'xls'].includes(ext)\n    })\n\n    for (const file of validFiles) {\n        try {\n            files.value.push({\n                id: Date.now() + Math.random(),\n                name: file.name,\n                file: file,\n                status: 'uploading',\n                isEditing: false,\n                newName: file.name\n            })\n            \n            // 调用上传 API\n            const response = await uploadFile(file)\n            // 更新文件状态\n            const uploadedFile = files.value.find(f => f.name === file.name)\n            if (uploadedFile) {\n                uploadedFile.status = 'uploaded'\n                uploadedFile.id = response.fileId // 使用服务器返回的文件ID\n            }\n        } catch (error) {\n            console.error('Upload failed:', error)\n            const failedFile = files.value.find(f => f.name === file.name)\n            if (failedFile) {\n                failedFile.status = 'error'\n            }\n        }\n    }\n}\n</script>\n\n<style scoped>\n/* 模态框基础样式 */\n.file-modal {\n    position: fixed;\n    top: 0; left: 0; right: 0; bottom: 0;\n    background: rgba(0,0,0,0.18);\n    z-index: 9999;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.file-content {\n    width: min(90vw, 480px);\n    max-height: min(90vh, 600px);\n    background: var(--bg-color, #fff);\n    border-radius: 12px;\n    box-shadow: 0 8px 32px rgba(0,0,0,0.18);\n    padding: clamp(12px, 2vw, 18px);\n    overflow-y: auto;\n}\n\n/* 头部样式 */\n.file-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-bottom: 16px;\n    border-bottom: 1px solid #eee;\n}\n\n.close-btn {\n    background: none;\n    border: none;\n    font-size: 1.5em;\n    cursor: pointer;\n    color: var(--text-color);\n}\n\n/* 上传区域样式 */\n.upload-area {\n    margin: 20px 0;\n    border: 2px dashed #ddd;\n    border-radius: 8px;\n    padding: clamp(20px, 4vw, 40px);\n    text-align: center;\n    transition: all 0.3s ease;\n}\n\n.upload-area.dragging {\n    border-color: #666;\n    background: #f8f9fa;\n}\n\n.file-input {\n    display: none;\n}\n\n.upload-tip {\n    color: #666;\n}\n\n.upload-icon {\n    font-size: 2em;\n    margin-bottom: 12px;\n    display: block;\n}\n\n.upload-tip button {\n    color: #2196f3;\n    background: none;\n    border: none;\n    cursor: pointer;\n    padding: 0 4px;\n}\n\n.sub-tip {\n    color: #999;\n    font-size: 0.9em;\n    margin-top: 8px;\n}\n\n/* 文件列表样式 */\n.file-list {\n    margin-top: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.file-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px;\n    background: #f8f9fa;\n    border-radius: 6px;\n    transition: transform 0.2s;\n}\n\n.file-item:hover {\n    transform: translateX(4px);\n}\n\n.file-info {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    flex: 1;\n}\n\n.file-name {\n    flex: 1;\n    font-size: 0.95em;\n}\n\n.file-name.editing input {\n    width: 100%;\n    padding: 4px 8px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    font-size: inherit;\n}\n\n.file-status {\n    font-size: 0.85em;\n    padding: 2px 8px;\n    border-radius: 12px;\n    background: #eee;\n}\n\n.file-status.local { background: #e3f2fd; color: #1976d2; }\n.file-status.uploading { background: #fff3e0; color: #f57c00; }\n.file-status.uploaded { background: #e8f5e9; color: #388e3c; }\n.file-status.error { background: #ffebee; color: #d32f2f; }\n\n.file-actions {\n    display: flex;\n    gap: 8px;\n}\n\n.file-actions button {\n    background: none;\n    border: none;\n    cursor: pointer;\n    padding: 4px;\n    opacity: 0.7;\n    transition: opacity 0.2s;\n}\n\n.file-actions button:hover {\n    opacity: 1;\n}\n\n/* 动画效果 */\n.fade-slide-enter-active,\n.fade-slide-leave-active {\n    transition: all 0.3s;\n}\n\n.fade-slide-enter-from,\n.fade-slide-leave-to {\n    opacity: 0;\n    transform: scale(0.95);\n}\n\n/* 响应式适配 */\n@media (max-width: 480px) {\n    .file-content {\n        width: 95vw;\n        margin: 10px;\n    }\n    \n    .upload-area {\n        padding: 15px;\n    }\n    \n    .file-item {\n        padding: 8px;\n    }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}