{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\n// dataMergeUtils.js\n// 多文件数据合并与主键处理工具函数\n\n/* eslint-disable */\n\n/**\n * 判断是否有主键（即所有y轴字段的文件都包含x轴字段）\n * @param {Object} xAxis - x轴配置\n * @param {Array|Object} yAxis - y轴配置\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {boolean}\n */\nexport function hasPrimaryKey(xAxis, yAxis, fileDataMap) {\n  if (!xAxis || !xAxis.field) return false;\n  const xField = xAxis.field;\n  const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n  return yArr.every(y => {\n    const yFileData = fileDataMap[y.file];\n    return yFileData && yFileData.length > 0 && yFileData[0].hasOwnProperty(xField);\n  });\n}\n\n/**\n * 针对饼图等 category/value 结构，组装 ECharts 所需的 series.data\n * @param {Object} config - chartConfig，需包含 category/value 字段\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {Array} seriesData\n */\nexport function buildPieSeriesData(config, fileDataMap) {\n  const {\n    category,\n    value\n  } = config;\n  if (!category || !value || !category.file || !value.file) return [];\n  // 取出数据（去掉标题行）\n  const catData = (fileDataMap[category.file] || []).slice(1);\n  const valData = (fileDataMap[value.file] || []).slice(1);\n  // 以category为主，value按行号对齐\n  const len = Math.min(catData.length, valData.length);\n  const result = [];\n  for (let i = 0; i < len; i++) {\n    const name = catData[i][category.field];\n    const rawVal = valData[i][value.field];\n    const parsedVal = parseFloat(rawVal);\n    // 保留缺失值为 null\n    const val = rawVal === null || rawVal === undefined || rawVal === '' || Number.isNaN(parsedVal) ? null : parsedVal;\n    if (name !== undefined && name !== null && name !== '') {\n      result.push({\n        name,\n        value: val\n      });\n    }\n  }\n  return result;\n}\n\n/**\n * 合并多文件数据，返回 { xData, yDataArr, mergeType, seriesData }\n * @param {Object} config - chartConfig\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {Object}\n */\nimport * as nullHandling from './nullHandling.js';\nexport function mergeChartData(config, fileDataMap, nullHandlingType = 'ignore') {\n  //! 调试是否有nullHandlingType\n  console.log('nullHandlingType set:', nullHandlingType);\n  // 饼图等特殊结构处理\n  if (config.category && config.value) {\n    const seriesData = buildPieSeriesData(config, fileDataMap);\n    return {\n      xData: [],\n      yDataArr: [],\n      mergeType: 'pie',\n      seriesData\n    };\n  }\n  const {\n    xAxis,\n    yAxis\n  } = config;\n  // 去除第一行（标题行）\n  const mainData = (fileDataMap[xAxis.file] || []).slice(1);\n  const xData = mainData.map(row => row[xAxis.field]);\n  const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n  const usePrimaryKey = hasPrimaryKey(xAxis, yAxis, fileDataMap);\n  let yDataArr = [];\n  if (usePrimaryKey) {\n    // 主键合并（左连接）\n    yDataArr = yArr.map(y => {\n      const yFileData = (fileDataMap[y.file] || []).slice(1);\n      let arr = mainData.map(row => {\n        const match = yFileData.find(r => r[xAxis.field] === row[xAxis.field]);\n        if (!match) return null;\n        const rawVal = match[y.field];\n        const parsedVal = parseFloat(rawVal);\n        return rawVal === null || rawVal === undefined || rawVal === '' || Number.isNaN(parsedVal) ? null : parsedVal;\n      });\n      console.log(`Before handling (primary key merge):`, arr, 'Type:', nullHandlingType);\n      // 应用缺失值处理\n      if (nullHandlingType && nullHandlingType !== 'ignore') {\n        const handler = nullHandling[nullHandlingType] || nullHandling.ignoreNull;\n        arr = handler(arr);\n        console.log(`After ${nullHandlingType} handling (primary key merge):`, arr);\n      }\n      return arr;\n    });\n  } else {\n    // 行号对齐\n    yDataArr = yArr.map(y => {\n      const yFileData = (fileDataMap[y.file] || []).slice(1);\n      let arr = yFileData.map(row => {\n        const rawVal = row[y.field];\n        const parsedVal = parseFloat(rawVal);\n        return rawVal === null || rawVal === undefined || rawVal === '' || Number.isNaN(parsedVal) ? null : parsedVal;\n      });\n      if (arr.length > xData.length) arr = arr.slice(0, xData.length);\n      while (arr.length < xData.length) arr.push(null);\n      // 应用缺失值处理\n      if (nullHandlingType && nullHandlingType !== 'ignore') {\n        const handler = nullHandling[nullHandlingType] || nullHandling.ignoreNull;\n        arr = handler(arr);\n        console.log(`After ${nullHandlingType} handling (rowIndex):`, arr);\n      }\n      return arr;\n    });\n  }\n  return {\n    xData,\n    yDataArr,\n    mergeType: usePrimaryKey ? 'primaryKey' : 'rowIndex',\n    seriesData: []\n  };\n}","map":{"version":3,"names":["hasPrimaryKey","xAxis","yAxis","fileDataMap","field","xField","yArr","Array","isArray","every","y","yFileData","file","length","hasOwnProperty","buildPieSeriesData","config","category","value","catData","slice","valData","len","Math","min","result","i","name","rawVal","parsedVal","parseFloat","val","undefined","Number","isNaN","push","nullHandling","mergeChartData","nullHandlingType","console","log","seriesData","xData","yDataArr","mergeType","mainData","map","row","usePrimaryKey","arr","match","find","r","handler","ignoreNull"],"sources":["D:/Learning Material/Git/Fuck-Charts/frontend/src/assets/JS/utils/dataMergeUtils.js"],"sourcesContent":["// dataMergeUtils.js\n// 多文件数据合并与主键处理工具函数\n\n/* eslint-disable */\n\n/**\n * 判断是否有主键（即所有y轴字段的文件都包含x轴字段）\n * @param {Object} xAxis - x轴配置\n * @param {Array|Object} yAxis - y轴配置\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {boolean}\n */\nexport function hasPrimaryKey(xAxis, yAxis, fileDataMap) {\n    if (!xAxis || !xAxis.field) return false;\n    const xField = xAxis.field;\n    const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n    return yArr.every(y => {\n        const yFileData = fileDataMap[y.file];\n        return yFileData && yFileData.length > 0 && yFileData[0].hasOwnProperty(xField);\n    });\n}\n\n/**\n * 针对饼图等 category/value 结构，组装 ECharts 所需的 series.data\n * @param {Object} config - chartConfig，需包含 category/value 字段\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {Array} seriesData\n */\nexport function buildPieSeriesData(config, fileDataMap) {\n    const { category, value } = config;\n    if (!category || !value || !category.file || !value.file) return [];\n    // 取出数据（去掉标题行）\n    const catData = (fileDataMap[category.file] || []).slice(1);\n    const valData = (fileDataMap[value.file] || []).slice(1);\n    // 以category为主，value按行号对齐\n    const len = Math.min(catData.length, valData.length);\n    const result = [];\n    for (let i = 0; i < len; i++) {\n        const name = catData[i][category.field];\n        const rawVal = valData[i][value.field];\n        const parsedVal = parseFloat(rawVal);\n        // 保留缺失值为 null\n        const val = (rawVal === null || rawVal === undefined || rawVal === '' || Number.isNaN(parsedVal)) ? null : parsedVal;\n        if (name !== undefined && name !== null && name !== '') {\n            result.push({ name, value: val });\n        }\n    }\n    return result;\n}\n\n/**\n * 合并多文件数据，返回 { xData, yDataArr, mergeType, seriesData }\n * @param {Object} config - chartConfig\n * @param {Object} fileDataMap - 文件名到对象数组的映射\n * @returns {Object}\n */\nimport * as nullHandling from './nullHandling.js';\nexport function mergeChartData(config, fileDataMap, nullHandlingType = 'ignore') {\n    //! 调试是否有nullHandlingType\n    console.log('nullHandlingType set:', nullHandlingType);\n    // 饼图等特殊结构处理\n    if (config.category && config.value) {\n        const seriesData = buildPieSeriesData(config, fileDataMap);\n        return { xData: [], yDataArr: [], mergeType: 'pie', seriesData };\n    }\n    const { xAxis, yAxis } = config;\n    // 去除第一行（标题行）\n    const mainData = (fileDataMap[xAxis.file] || []).slice(1);\n    const xData = mainData.map(row => row[xAxis.field]);\n    const yArr = Array.isArray(yAxis) ? yAxis : [yAxis];\n    const usePrimaryKey = hasPrimaryKey(xAxis, yAxis, fileDataMap);\n    let yDataArr = [];\n    if (usePrimaryKey) {\n        // 主键合并（左连接）\n        yDataArr = yArr.map(y => {\n            const yFileData = (fileDataMap[y.file] || []).slice(1);\n            let arr = mainData.map(row => {\n                const match = yFileData.find(r => r[xAxis.field] === row[xAxis.field]);\n                if (!match) return null;\n                const rawVal = match[y.field];\n                const parsedVal = parseFloat(rawVal);\n                return (rawVal === null || rawVal === undefined || rawVal === '' || Number.isNaN(parsedVal)) ? null : parsedVal;\n            });\n            console.log(`Before handling (primary key merge):`, arr, 'Type:', nullHandlingType);\n            // 应用缺失值处理\n            if (nullHandlingType && nullHandlingType !== 'ignore') {\n                const handler = nullHandling[nullHandlingType] || nullHandling.ignoreNull;\n                arr = handler(arr);\n                console.log(`After ${nullHandlingType} handling (primary key merge):`, arr);\n            }\n            return arr;\n        });\n    } else {\n        // 行号对齐\n        yDataArr = yArr.map(y => {\n            const yFileData = (fileDataMap[y.file] || []).slice(1);\n            let arr = yFileData.map(row => {\n                const rawVal = row[y.field];\n                const parsedVal = parseFloat(rawVal);\n                return (rawVal === null || rawVal === undefined || rawVal === '' || Number.isNaN(parsedVal)) ? null : parsedVal;\n            });\n            if (arr.length > xData.length) arr = arr.slice(0, xData.length);\n            while (arr.length < xData.length) arr.push(null);\n            // 应用缺失值处理\n            if (nullHandlingType && nullHandlingType !== 'ignore') {\n                const handler = nullHandling[nullHandlingType] || nullHandling.ignoreNull;\n                arr = handler(arr);\n                console.log(`After ${nullHandlingType} handling (rowIndex):`, arr);\n            }\n            return arr;\n        });\n    }\n    return { xData, yDataArr, mergeType: usePrimaryKey ? 'primaryKey' : 'rowIndex', seriesData: [] };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}