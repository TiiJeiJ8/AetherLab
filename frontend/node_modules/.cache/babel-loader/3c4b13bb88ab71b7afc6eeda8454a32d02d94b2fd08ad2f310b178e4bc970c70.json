{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { ref, watch } from 'vue';\nexport default {\n  __name: 'ChartMappingConfig',\n  props: {\n    mappingConfig: Array,\n    modelValue: Object\n  },\n  emits: ['update:modelValue'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n\n    /* no-undef */\n    /* eslint-disable */\n    const props = __props;\n    const emit = __emit;\n    const localConfig = ref({\n      ...props.modelValue\n    });\n    const dragOverIndex = ref(null);\n    watch(() => props.modelValue, val => {\n      localConfig.value = {\n        ...val\n      };\n    });\n    function updateField(key, value) {\n      localConfig.value[key] = value;\n      emit('update:modelValue', {\n        ...localConfig.value\n      });\n    }\n    function removeField(key, idx) {\n      if (typeof idx === 'number') {\n        // 多选，移除指定项\n        if (Array.isArray(localConfig.value[key])) {\n          localConfig.value[key].splice(idx, 1);\n          emit('update:modelValue', {\n            ...localConfig.value\n          });\n        }\n      } else {\n        // 单选，直接清空\n        localConfig.value[key] = '';\n        emit('update:modelValue', {\n          ...localConfig.value\n        });\n      }\n    }\n    function getFieldDisplay(val) {\n      if (typeof val === 'object' && val !== null) {\n        return val.field || '';\n      }\n      return val ?? '';\n    }\n    function handleDrop(event, key, multiple) {\n      try {\n        const dragData = JSON.parse(event.dataTransfer.getData('text/plain'));\n        if (dragData.type === 'column') {\n          if (multiple) {\n            // 多选，追加到数组，避免重复\n            if (!Array.isArray(localConfig.value[key])) {\n              localConfig.value[key] = [];\n            }\n            const exists = localConfig.value[key].some(f => f.field === dragData.column.name);\n            if (!exists) {\n              localConfig.value[key].push({\n                field: dragData.column.name,\n                type: dragData.column.type\n              });\n              emit('update:modelValue', {\n                ...localConfig.value\n              });\n            }\n          } else {\n            // 单选，直接替换\n            updateField(key, {\n              field: dragData.column.name,\n              type: dragData.column.type\n            });\n          }\n        }\n      } catch (e) {\n        // ignore\n      }\n      dragOverIndex.value = null;\n    }\n    const __returned__ = {\n      props,\n      emit,\n      localConfig,\n      dragOverIndex,\n      updateField,\n      removeField,\n      getFieldDisplay,\n      handleDrop,\n      ref,\n      watch\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","props","__props","emit","__emit","localConfig","modelValue","dragOverIndex","val","value","updateField","key","removeField","idx","Array","isArray","splice","getFieldDisplay","field","handleDrop","event","multiple","dragData","JSON","parse","dataTransfer","getData","type","exists","some","f","column","name","push","e"],"sources":["D:/Learning Material/Git/Fuck-Charts/frontend/src/components/ChartMappingConfig.vue"],"sourcesContent":["<template>\n<div class=\"mapping-section\">\n<div class=\"mapping-section-header\">\n    <h4>Data Mapping</h4>\n</div>\n<div v-for=\"(item, index) in mappingConfig\" :key=\"item.key\" class=\"mapping-item\">\n  <div class=\"mapping-item-header\">\n    <label class=\"mapping-label\">\n      {{ item.label }}\n      <span v-if=\"item.required\" class=\"required-star\">*</span>\n    </label>\n    <div class=\"mapping-type-tag\">{{ item.type }}</div>\n  </div>\n  <div\n    class=\"drop-zone\"\n    @dragover.prevent\n    @dragenter.prevent=\"dragOverIndex = index\"\n    @dragleave.prevent=\"dragOverIndex = null\"\n    @drop.prevent=\"handleDrop($event, item.key, item.multiple)\"\n    :class=\"{ 'drop-zone-active': dragOverIndex === index }\"\n  >\n    <!-- 多选模式：如series -->\n    <template v-if=\"item.multiple\">\n      <div v-if=\"!Array.isArray(localConfig[item.key]) || localConfig[item.key].length === 0\" class=\"drop-placeholder\">\n        <div class=\"drop-icon\">↓</div>\n        <span class=\"drop-text\">Drag columns here</span>\n      </div>\n      <div v-else class=\"mapping-multi-list\">\n        <div v-for=\"(field, idx) in localConfig[item.key]\" :key=\"field.field + idx\" class=\"mapping-multi-item\">\n          <span class=\"field-name\">{{ field.field }}</span>\n          <span class=\"field-type\">{{ field.type }}</span>\n          <button class=\"remove-btn\" @click=\"removeField(item.key, idx)\" title=\"Remove\">×</button>\n        </div>\n      </div>\n    </template>\n    <!-- 单选模式 -->\n    <template v-else>\n      <div v-if=\"!getFieldDisplay(localConfig[item.key])\" class=\"drop-placeholder\">\n        <div class=\"drop-icon\">↓</div>\n        <span class=\"drop-text\">Drag a column here</span>\n      </div>\n      <div v-else class=\"mapping-single-item\">\n        <span class=\"field-name\">{{ getFieldDisplay(localConfig[item.key]) }}</span>\n        <span class=\"field-type\">{{ localConfig[item.key]?.type }}</span>\n        <button class=\"remove-btn\" @click=\"removeField(item.key)\" title=\"Remove\">×</button>\n      </div>\n    </template>\n  </div>\n</div>\n</div>\n</template>\n\n<script setup>\n/* no-undef */\n/* eslint-disable */\nimport { ref, watch } from 'vue'\nconst props = defineProps({\n    mappingConfig: Array,\n    modelValue: Object\n})\nconst emit = defineEmits(['update:modelValue'])\n\nconst localConfig = ref({ ...props.modelValue })\nconst dragOverIndex = ref(null)\n\nwatch(() => props.modelValue, (val) => {\n  localConfig.value = { ...val }\n})\n\nfunction updateField(key, value) {\n  localConfig.value[key] = value\n  emit('update:modelValue', { ...localConfig.value })\n}\n\nfunction removeField(key, idx) {\n  if (typeof idx === 'number') {\n    // 多选，移除指定项\n    if (Array.isArray(localConfig.value[key])) {\n      localConfig.value[key].splice(idx, 1)\n      emit('update:modelValue', { ...localConfig.value })\n    }\n  } else {\n    // 单选，直接清空\n    localConfig.value[key] = ''\n    emit('update:modelValue', { ...localConfig.value })\n  }\n}\n\nfunction getFieldDisplay(val) {\n  if (typeof val === 'object' && val !== null) {\n    return val.field || ''\n  }\n  return val ?? ''\n}\n\nfunction handleDrop(event, key, multiple) {\n  try {\n    const dragData = JSON.parse(event.dataTransfer.getData('text/plain'))\n    if (dragData.type === 'column') {\n      if (multiple) {\n        // 多选，追加到数组，避免重复\n        if (!Array.isArray(localConfig.value[key])) {\n          localConfig.value[key] = []\n        }\n        const exists = localConfig.value[key].some(f => f.field === dragData.column.name)\n        if (!exists) {\n          localConfig.value[key].push({ field: dragData.column.name, type: dragData.column.type })\n          emit('update:modelValue', { ...localConfig.value })\n        }\n      } else {\n        // 单选，直接替换\n        updateField(key, { field: dragData.column.name, type: dragData.column.type })\n      }\n    }\n  } catch (e) {\n    // ignore\n  }\n  dragOverIndex.value = null\n}\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}