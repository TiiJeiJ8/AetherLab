{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, watch } from 'vue';\nimport ChartFilterConfig from './ChartFilterConfig.vue';\nexport default {\n  __name: 'ChartFilterConfig',\n  props: {\n    filterConfig: Array,\n    modelValue: Array\n  },\n  emits: ['update:modelValue'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n\n    /* no-undef */\n    /* eslint-disable */\n    const props = __props;\n    const emit = __emit;\n    const isCollapsed = ref(false);\n\n    // 递归处理嵌套层级\n    function flattenFilters(filters, level = 0) {\n      return filters.map(f => ({\n        ...f,\n        level\n      }));\n    }\n    const localFilters = ref(props.modelValue ? flattenFilters(props.modelValue) : []);\n    watch(() => props.modelValue, val => {\n      localFilters.value = flattenFilters(val || []);\n    });\n    watch(localFilters, val => {\n      emit('update:modelValue', val.map(({\n        level,\n        ...rest\n      }) => rest));\n    }, {\n      deep: true\n    });\n    function toggleCollapse() {\n      isCollapsed.value = !isCollapsed.value;\n    }\n    function addFilter(idx) {\n      const newFilter = {\n        type: 'filter',\n        dimension: '',\n        operator: '==',\n        value: ''\n      };\n      if (idx === null || idx === undefined) {\n        localFilters.value.push({\n          ...newFilter,\n          level: 0\n        });\n      } else {\n        localFilters.value.splice(idx + 1, 0, {\n          ...newFilter,\n          level: localFilters.value[idx].level\n        });\n      }\n    }\n    function addGroup(type) {\n      localFilters.value.push({\n        type,\n        children: [],\n        level: 0\n      });\n    }\n    function addChildFilter(idx, type) {\n      if (!localFilters.value[idx].children) localFilters.value[idx].children = [];\n      localFilters.value[idx].children.push({\n        type: 'filter',\n        dimension: '',\n        operator: '==',\n        value: '',\n        level: (localFilters.value[idx].level || 0) + 1\n      });\n    }\n    function addExpression() {\n      localFilters.value.push({\n        type: 'expression',\n        expr: '',\n        level: 0\n      });\n    }\n    function removeFilter(idx) {\n      localFilters.value.splice(idx, 1);\n    }\n    const __returned__ = {\n      props,\n      emit,\n      isCollapsed,\n      flattenFilters,\n      localFilters,\n      toggleCollapse,\n      addFilter,\n      addGroup,\n      addChildFilter,\n      addExpression,\n      removeFilter,\n      ref,\n      watch,\n      ChartFilterConfig\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","ChartFilterConfig","props","__props","emit","__emit","isCollapsed","flattenFilters","filters","level","map","f","localFilters","modelValue","val","value","rest","deep","toggleCollapse","addFilter","idx","newFilter","type","dimension","operator","undefined","push","splice","addGroup","children","addChildFilter","addExpression","expr","removeFilter"],"sources":["D:/Learning Material/Git/Fuck-Charts/frontend/src/components/Chart/ChartFilterConfig.vue"],"sourcesContent":["<template>\n<div class=\"filter-section\">\n  <div class=\"section-header filter-header\" @click=\"toggleCollapse\">\n    <h4>Data Filtering</h4>\n    <span class=\"collapse-icon\" :class=\"{ collapsed: isCollapsed }\">&#9660;</span>\n  </div>\n  <transition name=\"collapse\">\n    <div v-show=\"!isCollapsed\" class=\"filter-content\">\n      <template v-for=\"(filter, idx) in localFilters\" :key=\"idx\">\n        <div class=\"filter-item\" :style=\"{marginLeft: filter.level * 16 + 'px'}\">\n          <div style=\"display:flex;align-items:center;gap:8px;\">\n            <span v-if=\"filter.type === 'filter'\">\n              字段：<input v-model=\"filter.dimension\" style=\"width:80px;\" placeholder=\"dimension\" />\n              条件：\n              <select v-model=\"filter.operator\">\n                <option value=\"==\">=</option>\n                <option value=\">\">&gt;</option>\n                <option value=\"<\">&lt;</option>\n                <option value=\">=\">&ge;</option>\n                <option value=\"<=\">&le;</option>\n                <option value=\"!=\">≠</option>\n                <option value=\"in\">in</option>\n                <option value=\"not in\">not in</option>\n                <option value=\"contains\">contains</option>\n                <option value=\"!contains\">!contains</option>\n              </select>\n              值：<input v-model=\"filter.value\" style=\"width:80px;\" :placeholder=\"filter.operator==='in'||filter.operator==='not in'?'逗号分隔':''\" />\n            </span>\n            <span v-else-if=\"filter.type === 'expression'\">\n              表达式：<input v-model=\"filter.expr\" style=\"width:180px;\" placeholder=\"如: [dim] > 10 && [dim2] < 5\" />\n            </span>\n            <span v-else-if=\"filter.type === 'select'\">\n              <select v-model=\"filter.value\">\n                <option v-for=\"opt in filter.options\" :key=\"opt\" :value=\"opt\">{{ opt }}</option>\n              </select>\n            </span>\n            <span v-else-if=\"filter.type === 'and' || filter.type === 'or'\">\n              <b>{{ filter.type === 'and' ? '且' : '或' }}条件组</b>\n            </span>\n            <span v-else-if=\"filter.type === 'not'\">\n              <b>非条件组</b>\n            </span>\n            <button @click=\"removeFilter(idx)\" style=\"color:#c00;\">删除</button>\n          </div>\n          <!-- 嵌套递归渲染 -->\n          <div v-if=\"filter.children && filter.children.length\">\n            <ChartFilterConfig\n              v-model=\"filter.children\"\n              :filterConfig=\"[]\"\n            />\n          </div>\n          <!-- 添加子条件按钮 -->\n          <div v-if=\"['and','or','not'].includes(filter.type)\" style=\"margin-top:4px;\">\n            <button @click=\"addChildFilter(idx, filter.type)\">添加子条件</button>\n          </div>\n        </div>\n      </template>\n      <!-- 顶层添加条件按钮 -->\n      <div style=\"margin-top:8px;\">\n        <button @click=\"addFilter(null)\">添加条件</button>\n        <button @click=\"addGroup('and')\">添加且组</button>\n        <button @click=\"addGroup('or')\">添加或组</button>\n        <button @click=\"addGroup('not')\">添加非组</button>\n        <button @click=\"addExpression\">添加表达式</button>\n      </div>\n    </div>\n  </transition>\n</div>\n</template>\n\n<script setup>\n/* no-undef */\n/* eslint-disable */\nimport { ref, watch } from 'vue'\nimport ChartFilterConfig from './ChartFilterConfig.vue'\nconst props = defineProps({\n  filterConfig: Array,\n  modelValue: Array\n})\nconst emit = defineEmits(['update:modelValue'])\nconst isCollapsed = ref(false)\n\n// 递归处理嵌套层级\nfunction flattenFilters(filters, level = 0) {\n  return filters.map(f => ({ ...f, level }))\n}\n\nconst localFilters = ref(props.modelValue ? flattenFilters(props.modelValue) : [])\n\nwatch(() => props.modelValue, (val) => {\n  localFilters.value = flattenFilters(val || [])\n})\n\nwatch(localFilters, (val) => {\n  emit('update:modelValue', val.map(({ level, ...rest }) => rest))\n}, { deep: true })\n\nfunction toggleCollapse() {\n  isCollapsed.value = !isCollapsed.value\n}\n\nfunction addFilter(idx) {\n  const newFilter = {\n    type: 'filter',\n    dimension: '',\n    operator: '==',\n    value: ''\n  }\n  if (idx === null || idx === undefined) {\n    localFilters.value.push({ ...newFilter, level: 0 })\n  } else {\n    localFilters.value.splice(idx + 1, 0, { ...newFilter, level: localFilters.value[idx].level })\n  }\n}\n\nfunction addGroup(type) {\n  localFilters.value.push({ type, children: [], level: 0 })\n}\n\nfunction addChildFilter(idx, type) {\n  if (!localFilters.value[idx].children) localFilters.value[idx].children = []\n  localFilters.value[idx].children.push({ type: 'filter', dimension: '', operator: '==', value: '', level: (localFilters.value[idx].level || 0) + 1 })\n}\n\nfunction addExpression() {\n  localFilters.value.push({ type: 'expression', expr: '', level: 0 })\n}\n\nfunction removeFilter(idx) {\n  localFilters.value.splice(idx, 1)\n}\n</script>\n\n<style scoped>\n.filter-section {\n    margin-bottom: 16px;\n    border-radius: 8px;\n    background: var(--bg-secondary);\n    box-shadow: 0 1px 2px rgba(0,0,0,0.03);\n}\n.filter-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    cursor: pointer;\n    padding: 8px 12px;\n    user-select: none;\n}\n.collapse-icon {\n    font-size: 16px;\n    margin-left: 8px;\n    transition: transform 0.2s;\n}\n.collapse-icon.collapsed {\n    transform: rotate(-90deg);\n}\n.filter-content {\n    padding: 8px 16px 12px 16px;\n}\n.filter-item {\n    margin-bottom: 12px;\n}\n.collapse-enter-active, .collapse-leave-active {\n    transition: max-height 0.25s cubic-bezier(.4,0,.2,1), opacity 0.2s;\n}\n.collapse-enter-from, .collapse-leave-to {\n    max-height: 0;\n    opacity: 0;\n    overflow: hidden;\n}\n.collapse-enter-to, .collapse-leave-from {\n    max-height: 300px;\n    opacity: 1;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}