{"ast":null,"code":"import { createElementVNode as _createElementVNode, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, resolveComponent as _resolveComponent, createVNode as _createVNode, toDisplayString as _toDisplayString, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, normalizeStyle as _normalizeStyle, Transition as _Transition, withCtx as _withCtx } from \"vue\";\nconst _hoisted_1 = {\n  class: \"history-content-rect\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"empty-history-tip\"\n};\nconst _hoisted_3 = {\n  class: \"history-list-rect\"\n};\nconst _hoisted_4 = {\n  class: \"thumb-title-row-rect\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  class: \"chart-history-title-rect\"\n};\nconst _hoisted_7 = [\"title\", \"onClick\"];\nconst _hoisted_8 = {\n  key: 0,\n  class: \"title-ellipsis-tooltip\"\n};\nconst _hoisted_9 = [\"onBlur\", \"onKeydown\", \"title\"];\nconst _hoisted_10 = [\"onClick\"];\nconst _hoisted_11 = {\n  class: \"confirm-content\"\n};\nconst _hoisted_12 = {\n  name: \"confirm-buttons\"\n};\nexport function render(_ctx, _cache) {\n  const _component_ChartThumbnail = _resolveComponent(\"ChartThumbnail\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createVNode(_Transition, {\n    name: \"fade-slide\"\n  }, {\n    default: _withCtx(() => [_ctx.show ? (_openBlock(), _createElementBlock(\"div\", {\n      key: 0,\n      class: \"history-modal-draggable\",\n      style: _normalizeStyle(_ctx.modalStyle),\n      onMousedown: _cache[4] || (_cache[4] = _withModifiers((...args) => _ctx.startDrag && _ctx.startDrag(...args), [\"self\"]))\n    }, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", {\n      class: \"history-header-rect\",\n      onMousedown: _cache[1] || (_cache[1] = _withModifiers((...args) => _ctx.startDrag && _ctx.startDrag(...args), [\"stop\"]))\n    }, [_cache[8] || (_cache[8] = _createElementVNode(\"span\", {\n      style: {\n        \"margin\": \"15px\"\n      }\n    }, \"Charts Storage\", -1 /* HOISTED */)), _createElementVNode(\"button\", {\n      class: \"close-btn\",\n      style: {\n        \"margin\": \"15px\"\n      },\n      onClick: _cache[0] || (_cache[0] = (...args) => _ctx.onClose && _ctx.onClose(...args))\n    }, \"×\")], 32 /* NEED_HYDRATION */), !_ctx.chartHistory?.length ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \" No saved charts available. \")) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.chartHistory, (item, idx) => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        key: idx,\n        class: \"chart-history-item-rect\"\n      }, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", {\n        class: \"chart-thumb-rect\",\n        onClick: $event => _ctx.onPreview(item)\n      }, [_createVNode(_component_ChartThumbnail, {\n        option: item.option\n      }, null, 8 /* PROPS */, [\"option\"])], 8 /* PROPS */, _hoisted_5), _createElementVNode(\"div\", _hoisted_6, [_ctx.editingIndex !== idx ? (_openBlock(), _createElementBlock(_Fragment, {\n        key: 0\n      }, [_createElementVNode(\"span\", {\n        class: \"history-title-text\",\n        title: item.title,\n        onClick: $event => _ctx.startEditTitle(idx, item.title),\n        style: {\n          \"cursor\": \"pointer\",\n          \"user-select\": \"text\"\n        }\n      }, _toDisplayString(item.title.length > 7 ? item.title.slice(0, 7) + '…' : item.title), 9 /* TEXT, PROPS */, _hoisted_7), item.title.length > 7 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, _toDisplayString(item.title), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */)) : _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n        key: 1,\n        ref_for: true,\n        ref: \"editInputRef\",\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => _ctx.editTitle = $event),\n        class: \"history-title-input\",\n        onBlur: $event => _ctx.saveEditTitle(idx),\n        onKeydown: [_withKeys(_withModifiers($event => _ctx.saveEditTitle(idx), [\"prevent\"]), [\"enter\"]), _cache[3] || (_cache[3] = _withKeys((...args) => _ctx.cancelEditTitle && _ctx.cancelEditTitle(...args), [\"esc\"]))],\n        maxlength: \"30\",\n        placeholder: 'Enter title',\n        style: {\n          \"width\": \"90%\",\n          \"max-width\": \"160px\",\n          \"font-size\": \"1em\",\n          \"border-radius\": \"5px\",\n          \"border\": \"1px solid #d0d0d0\",\n          \"padding\": \"2px 6px\"\n        },\n        title: _ctx.editTitle,\n        autocomplete: \"off\"\n      }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_9)), [[_vModelText, _ctx.editTitle]])]), _createElementVNode(\"button\", {\n        class: \"delete-btn-rect\",\n        onClick: _withModifiers($event => _ctx.confirmDelete(idx), [\"stop\"]),\n        title: \"Delete\"\n      }, \"×\", 8 /* PROPS */, _hoisted_10)])]);\n    }), 128 /* KEYED_FRAGMENT */))])])], 36 /* STYLE, NEED_HYDRATION */)) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  }), _createVNode(_Transition, {\n    name: \"fade\"\n  }, {\n    default: _withCtx(() => [_ctx.showDeleteConfirm ? (_openBlock(), _createElementBlock(\"div\", {\n      key: 0,\n      class: \"confirm-modal\",\n      onClick: _cache[7] || (_cache[7] = _withModifiers((...args) => _ctx.cancelDelete && _ctx.cancelDelete(...args), [\"self\"]))\n    }, [_createElementVNode(\"div\", _hoisted_11, [_cache[9] || (_cache[9] = _createElementVNode(\"h3\", {\n      style: {\n        \"color\": \"var(--text-color)\"\n      }\n    }, \"Confirmation\", -1 /* HOISTED */)), _cache[10] || (_cache[10] = _createElementVNode(\"p\", null, \"Are you sure you want to delete this chart? This operation is irreversible.\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"button\", {\n      class: \"cancel-history-btn\",\n      onClick: _cache[5] || (_cache[5] = (...args) => _ctx.cancelDelete && _ctx.cancelDelete(...args))\n    }, \"Cancel\"), _createElementVNode(\"button\", {\n      class: \"confirm-history-btn\",\n      onClick: _cache[6] || (_cache[6] = (...args) => _ctx.handleDelete && _ctx.handleDelete(...args))\n    }, \"Confirm\")])])])) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","key","name","_createElementBlock","_createVNode","_Transition","default","_withCtx","_ctx","show","style","_normalizeStyle","modalStyle","onMousedown","_cache","_withModifiers","args","startDrag","_createElementVNode","_hoisted_1","onClick","onClose","chartHistory","length","_hoisted_2","_createCommentVNode","_hoisted_3","_Fragment","_renderList","item","idx","_hoisted_4","$event","onPreview","_component_ChartThumbnail","option","_hoisted_5","_hoisted_6","editingIndex","title","startEditTitle","slice","_hoisted_7","_hoisted_8","_toDisplayString","ref_for","ref","editTitle","onBlur","saveEditTitle","onKeydown","_withKeys","cancelEditTitle","maxlength","placeholder","autocomplete","_hoisted_9","confirmDelete","_hoisted_10","_","showDeleteConfirm","cancelDelete","_hoisted_11","_hoisted_12","handleDelete"],"sources":["D:\\Learning Material\\Git\\Fuck-Charts\\frontend\\src\\components\\Chart\\ChartHistoryModal.vue"],"sourcesContent":["<template>\n<div>\n<transition name=\"fade-slide\">\n    <div v-if=\"show\" class=\"history-modal-draggable\" :style=\"modalStyle\" @mousedown.self=\"startDrag\">\n        <div class=\"history-content-rect\">\n            <div class=\"history-header-rect\" @mousedown.stop=\"startDrag\">\n                <span style=\"margin: 15px;\">Charts Storage</span>\n                <button class=\"close-btn\" style=\"margin: 15px;\" @click=\"onClose\">×</button>\n            </div>\n            <div v-if=\"!chartHistory?.length\" class=\"empty-history-tip\">\n                No saved charts available.\n            </div>\n            <div class=\"history-list-rect\">\n            <div\n                v-for=\"(item, idx) in chartHistory\"\n                :key=\"idx\"\n                class=\"chart-history-item-rect\"\n            >\n                <div class=\"thumb-title-row-rect\">\n                <div class=\"chart-thumb-rect\" @click=\"onPreview(item)\">\n                    <ChartThumbnail :option=\"item.option\" />\n                </div>\n                <div class=\"chart-history-title-rect\">\n                  <template v-if=\"editingIndex !== idx\">\n                    <span\n                      class=\"history-title-text\"\n                      :title=\"item.title\"\n                      @click=\"startEditTitle(idx, item.title)\"\n                      style=\"cursor: pointer; user-select: text;\"\n                    >\n                      {{ item.title.length > 7 ? (item.title.slice(0, 7) + '…') : item.title }}\n                    </span>\n                    <span v-if=\"item.title.length > 7\" class=\"title-ellipsis-tooltip\">{{ item.title }}</span>\n                  </template>\n                  <template v-else>\n                    <input\n                      ref=\"editInputRef\"\n                      v-model=\"editTitle\"\n                      class=\"history-title-input\"\n                      @blur=\"saveEditTitle(idx)\"\n                      @keydown.enter.prevent=\"saveEditTitle(idx)\"\n                      @keydown.esc=\"cancelEditTitle\"\n                      maxlength=\"30\"\n                      :placeholder=\"'Enter title'\"\n                      style=\"width: 90%; max-width: 160px; font-size: 1em; border-radius: 5px; border: 1px solid #d0d0d0; padding: 2px 6px;\"\n                      :title=\"editTitle\"\n                      autocomplete=\"off\"\n                    />\n                  </template>\n                </div>\n                <button class=\"delete-btn-rect\" @click.stop=\"confirmDelete(idx)\" title=\"Delete\">×</button>\n                </div>\n            </div>\n            </div>\n        </div>\n    </div>\n</transition>\n<transition name=\"fade\">\n    <div v-if=\"showDeleteConfirm\" class=\"confirm-modal\" @click.self=\"cancelDelete\">\n        <div class=\"confirm-content\">\n            <h3 style=\"color: var(--text-color);\">Confirmation</h3>\n            <p>Are you sure you want to delete this chart? This operation is irreversible.</p>\n            <div name=\"confirm-buttons\">\n            <button class=\"cancel-history-btn\" @click=\"cancelDelete\">Cancel</button>\n            <button class=\"confirm-history-btn\" @click=\"handleDelete\">Confirm</button>\n            </div>\n        </div>\n    </div>\n</transition>\n</div>\n</template>\n\n<script setup>\n/\nimport { nextTick } from 'vue'\n// 编辑标题相关\nconst editingIndex = ref(null)\nconst editTitle = ref('')\nconst editInputRef = ref(null)\n\nfunction startEditTitle(idx, title) {\n    editingIndex.value = idx\n    editTitle.value = title\n    nextTick(() => {\n        if (editInputRef.value) editInputRef.value.focus()\n    })\n}\nfunction saveEditTitle(idx) {\n    const val = editTitle.value.trim()\n    if (!val) {\n        // 非空校验，可加提示\n        editTitle.value = ''\n        editingIndex.value = null\n        return\n    }\n    // 更新标题和config\n    const item = chartHistory[idx]\n    if (item) {\n        item.title = val\n        if (item.config) item.config.title = val\n    }\n    editingIndex.value = null\n}\nfunction cancelEditTitle() {\n    editingIndex.value = null\n}\n/* eslint-disable */\nimport ChartThumbnail from './ChartThumbnail.vue'\nimport { ref, onMounted, onBeforeUnmount, defineEmits, defineProps } from 'vue'\n// 拖拽浮窗相关\nconst modalStyle = ref({ left: '50vw', top: '12vh' })\nconst dragOffset = { x: 0, y: 0 }\nlet dragging = false\n\nfunction startDrag (e) {\n    if (e.button !== 0) return\n    dragging = true\n    const modal = document.querySelector('.history-modal-draggable')\n    const rect = modal.getBoundingClientRect()\n    dragOffset.x = e.clientX - rect.left\n    dragOffset.y = e.clientY - rect.top\n    document.addEventListener('mousemove', onDrag)\n    document.addEventListener('mouseup', stopDrag)\n}\nfunction onDrag (e) {\n    if (!dragging) return\n    let left = e.clientX - dragOffset.x\n    let top = e.clientY - dragOffset.y\n    // 限制在窗口内\n    const minLeft = 20\n    const minTop = 20\n    const maxLeft = window.innerWidth - 480 - 20\n    const maxTop = window.innerHeight - 420 - 20\n    left = Math.max(minLeft, Math.min(left, maxLeft))\n    top = Math.max(minTop, Math.min(top, maxTop))\n    modalStyle.value = { left: left + 'px', top: top + 'px' }\n}\nfunction stopDrag () {\n    dragging = false\n    document.removeEventListener('mousemove', onDrag)\n    document.removeEventListener('mouseup', stopDrag)\n}\nonMounted(() => {\n    // 初始居中\n    const w = 480\n    const h = 420\n    modalStyle.value = {\n        left: (window.innerWidth - w) / 2 + 'px',\n        top: (window.innerHeight - h) / 3 + 'px'\n    }\n})\nonBeforeUnmount(() => {\n    stopDrag()\n})\n// 删除确认\nconst showDeleteConfirm = ref(false)\nconst deleteIndex = ref(null)\n\nfunction confirmDelete (idx) {\n    deleteIndex.value = idx\n    showDeleteConfirm.value = true\n}\n\nfunction cancelDelete () {\n    showDeleteConfirm.value = false\n    deleteIndex.value = null\n}\n\nfunction handleDelete () {\n    if (deleteIndex.value !== null) {\n        emit('delete', deleteIndex.value)\n        showDeleteConfirm.value = false\n        deleteIndex.value = null\n    }\n}\n\n// props\ndefineProps({\n    show: Boolean,\n    chartHistory: Array\n})\nconst emit = defineEmits(['close', 'preview', 'delete'])\nfunction onClose () { emit('close') }\nfunction onPreview (item) { emit('preview', item) }\n</script>\n\n<style scoped>\n\n@import '../../assets/CSS/ChartHistoryModal.css';\n\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}